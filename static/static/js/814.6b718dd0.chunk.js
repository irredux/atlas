"use strict";(self.webpackChunkatlas=self.webpackChunkatlas||[]).push([[814],{2583:function(e,t,n){n.d(t,{v:function(){return l}});var r=n(885),s=n(7022),i=n(2469),a=n(6407),c=n(2791),o=n(184);function l(){a.Q.changeLog=a.Q.changeLog.sort((function(e,t){return e.date<t.date})),a.Q.changeLog=a.Q.changeLog.filter((function(e){return void 0===e.project||e.project===a.Q.project_name}));var e=(0,c.useState)(!(a.Q.changeLog.length>5)),t=(0,r.Z)(e,2),n=t[0],l=t[1];return(0,o.jsxs)(s.Z,{children:[a.Q.changeLog.map((function(e,t){return n||t<5?(0,o.jsxs)(i.Z,{variant:0===t?"primary":"secondary",children:[(0,o.jsx)(i.Z.Heading,{children:e.title}),(0,o.jsx)("i",{children:(r=e.date,"".concat(r.substring(8,10),". ").concat({"01":"Januar","02":"Februar","03":"M\xe4rz","04":"April","05":"Mai","06":"Juni","07":"Juli","08":"August","09":"September",10:"Oktober",11:"November",12:"Dezember"}[r.substring(5,7)]," ").concat(r.substring(0,4)))}),e.description]},t):null;var r})),n?null:(0,o.jsx)(i.Z,{style:{cursor:"pointer",marginTop:"100px",textAlign:"center"},variant:"secondary",onClick:function(){l(!0)},children:"Alle \xc4nderungen anzeigen."})]})}},8814:function(e,t,n){n.r(t),n.d(t,{MainBody:function(){return De},MainNavBar:function(){return Be},getSetting:function(){return Ee},getSettings:function(){return Qe},setSetting:function(){return Te}});var r=n(5861),s=n(885),i=n(7757),a=n.n(i),c=n(2791),o=n(4483),l=n(3174),u=n(2354),d=n(4817),f=n(7022),p=n(9249),x=n(7762),h=n(9485),g=n(1734),m=n(2591),v=n(5353),j=n(6407),Z=n(3222),k=n(184);function y(e){var t=(0,c.useState)(Qe().projectSort),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(0),u=(0,s.Z)(l,2),d=u[0],p=u[1],v=(0,c.useState)(0),y=(0,s.Z)(v,2),_=y[0],C=y[1],S=(0,c.useState)(""),I=(0,s.Z)(S,2),N=I[0],Q=I[1],E=(0,c.useState)([]),T=(0,s.Z)(E,2),D=T[0],B=T[1],z=(0,c.useState)([]),A=(0,s.Z)(z,2),M=A[0],L=A[1],R=(0,c.useState)([]),O=(0,s.Z)(R,2),F=O[0],K=O[1],P=(0,c.useState)([]),V=(0,s.Z)(P,2),X=V[0],G=V[1];(0,c.useEffect)((function(){U()}),[i]),(0,c.useEffect)((function(){var e=function(){var e=(0,r.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return e.next=4,j.Q.user.getAll({order:["last_name"]});case 4:t=e.sent,G(t.map((function(e){return[e.id,"".concat(e.first_name," ").concat(e.last_name)]})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var U=function(){var e=(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=B,e.next=3,j.Q.project.get({user_id:j.Q.me.id,status:1},{order:[i]});case 3:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=L,e.next=8,j.Q.project.get({status:2},{order:[i]});case 8:return e.t3=e.sent,(0,e.t2)(e.t3),e.t4=K,e.next=13,j.Q.project.get({shared_id:j.Q.me.id},{order:[i]});case 13:e.t5=e.sent,(0,e.t4)(e.t5);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=(0,r.Z)(a().mark((function e(t){var n,r,s,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Soll das Projekt mit der ID '".concat(t,"' wirklich gel\xf6scht werden? Dieser Schritt kann nicht r\xfcckg\xe4ngig gemacht werden."))){e.next=29;break}return e.next=3,j.Q.article.get({project_id:t});case 3:if(!((n=e.sent).length>0)){e.next=7;break}return e.next=7,j.Q.article.delete(n.map((function(e){return e.id})));case 7:return e.next=9,j.Q.sections.get({project_id:t});case 9:if(!((r=e.sent).length>0)){e.next=13;break}return e.next=13,j.Q.sections.delete(r.map((function(e){return e.id})));case 13:return e.next=15,j.Q.tags.get({project_id:t});case 15:if(!((s=e.sent).length>0)){e.next=19;break}return e.next=19,j.Q.tags.delete(s.map((function(e){return e.id})));case 19:return e.next=21,j.Q.tag_lnks.get({project_id:t});case 21:if(!((i=e.sent).length>0)){e.next=25;break}return e.next=25,j.Q.tag_lnks.delete(i.map((function(e){return e.id})));case 25:return e.next=27,j.Q.project.delete(t);case 27:return e.next=29,U();case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=(0,r.Z)(a().mark((function e(t){var n,r,s,i,c,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.project.get({id:t});case 2:return delete(n=(n=e.sent)[0]).id,n.shared_id=null,n.name="".concat(n.name,"  (Kopie)"),e.next=9,j.Q.project.save(n);case 9:return r=e.sent,e.next=12,j.Q.sections.get({project_id:t});case 12:return s=e.sent,e.next=15,j.Q.sections.save(s.map((function(e){return e.project_id=r,e.shared_id=null,e})));case 15:return e.next=17,j.Q.article.get({project_id:t});case 17:return i=e.sent,e.next=20,j.Q.article.save(i.map((function(e){return e.project_id=r,e.shared_id=null,e})));case 20:return e.next=22,j.Q.tags.get({project_id:t});case 22:return c=e.sent,e.next=25,j.Q.tags.save(c.map((function(e){return e.project_id=r,e.shared_id=null,e})));case 25:return e.next=27,j.Q.tag_lnks.get({project_id:t});case 27:return o=e.sent,e.next=30,j.Q.tag_lnks.save(o.map((function(e){return e.project_id=r,e.shared_id=null,e})));case 30:return e.next=32,U();case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=(0,r.Z)(a().mark((function e(t,n){var r,s,i,c,o,l,u,d,f,p,h,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,s=null,!t){e.next=10;break}return e.next=5,j.Q.project.get({id:n},{select:["user_id"]});case 5:i=e.sent,s=t,r=i[0].user_id,e.next=15;break;case 10:return e.next=12,j.Q.project.get({id:n},{select:["shared_id"]});case 12:c=e.sent,r=null,s=c[0].shared_id;case 15:return e.next=17,j.Q.project.save({id:n,shared_id:r,user_id:s});case 17:return e.next=19,j.Q.article.get({project_id:n});case 19:o=e.sent,l=(0,x.Z)(o),e.prev=21,l.s();case 23:if((u=l.n()).done){e.next=32;break}return(d=u.value).user_id=s,d.shared_id=r,e.next=29,j.Q.article.save(d);case 29:e.sent;case 30:e.next=23;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(21),l.e(e.t0);case 37:return e.prev=37,l.f(),e.finish(37);case 40:return e.next=42,j.Q.sections.get({project_id:n});case 42:f=e.sent,p=(0,x.Z)(f),e.prev=44,p.s();case 46:if((h=p.n()).done){e.next=54;break}return(g=h.value).user_id=s,g.shared_id=r,e.next=52,j.Q.sections.save(g);case 52:e.next=46;break;case 54:e.next=59;break;case 56:e.prev=56,e.t1=e.catch(44),p.e(e.t1);case 59:return e.prev=59,p.f(),e.finish(59);case 62:return e.next=64,U();case 64:case"end":return e.stop()}}),e,null,[[21,34,37,40],[44,56,59,62]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Z.v0,{show:d>0,title:"Projekt-Name ausw\xe4hlen",msg:"Geben Sie einen Namen f\xfcr das Projekt ein:",input:N,onReplay:function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1==t||""==t){e.next=3;break}return e.next=3,j.Q.project.save({id:d,name:t});case 3:return e.next=6,U();case 6:p(0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,k.jsx)(Z.v0,{show:_>0,title:"Projekt freigeben",msg:"Wem wollen Sie das Projekt freigeben?",dropDown:X,onReplay:function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),-1==t||""==t){e.next=4;break}return e.next=4,J(t,_);case 4:C(0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,k.jsx)(f.Z,{children:(0,k.jsxs)(h.Z,{defaultActiveKey:"active",children:[(0,k.jsx)(g.Z,{eventKey:"active",title:"aktive Projekte",children:(0,k.jsx)(f.Z,{className:"m-4",style:{width:"auto"},children:(0,k.jsxs)(m.Z,{width:"100%",hover:!0,children:[(0,k.jsx)("thead",{children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{width:"30%",children:"Name"}),(0,k.jsx)("th",{width:"20%"}),(0,k.jsx)("th",{width:"20%",children:"\xc4nderungsdatum"}),(0,k.jsx)("th",{width:"20%",children:"Erstelldatum"}),(0,k.jsx)("th",{width:"10%"})]})}),(0,k.jsx)("tbody",{children:D.map((function(t){var n=[["umbenennen",function(){Q(t.name),p(t.id)}],["kopieren",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H(t.id);case 1:case"end":return e.stop()}}),e)})))],["ins Archiv",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.project.save({id:t.id,status:2});case 2:return e.next=4,U();case 4:case"end":return e.stop()}}),e)})))],["freigeben",function(){C(t.id)}]];return t.shared_id>0&&(n=[["umbenennen",function(){Q(t.name),p(t.id)}],["kopieren",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H(t.id);case 1:case"end":return e.stop()}}),e)})))],["freigabe beenden",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(null,t.id);case 2:case"end":return e.stop()}}),e)})))]]),(0,k.jsx)(w,{p:t,openProject:function(){!function(e){var t=localStorage.getItem("openRecentEditor");t?(t=(t=JSON.parse(t)).filter((function(t){return t!==e}))).push(e):t=[e],localStorage.setItem("openRecentEditor",JSON.stringify(t))}(t.id),e.loadMain(null,"editor",t.id)},editMenu:n,deleteProject:function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},t.id)}))})]})})}),(0,k.jsx)(g.Z,{eventKey:"archive",title:"Archiv",disabled:0===M.length,children:(0,k.jsx)(f.Z,{className:"m-4",style:{width:"auto"},children:(0,k.jsxs)(m.Z,{width:"100%",hover:!0,children:[(0,k.jsx)("thead",{children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{width:"30%",children:"Name"}),(0,k.jsx)("th",{width:"20%"}),(0,k.jsx)("th",{width:"20%",children:"\xc4nderungsdatum"}),(0,k.jsx)("th",{width:"20%",children:"Erstelldatum"}),(0,k.jsx)("th",{width:"10%"})]})}),(0,k.jsx)("tbody",{children:M.map((function(e){return(0,k.jsx)(w,{openProject:null,p:e,editMenu:[["zu den aktiven Projekten",(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.project.save({id:e.id,status:1});case 2:return t.next=4,U();case 4:case"end":return t.stop()}}),t)})))]],deleteProject:function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},e.id)}))})]})})}),(0,k.jsx)(g.Z,{eventKey:"shared",title:"freigegebene Projekte",disabled:0===F.length,children:(0,k.jsx)(f.Z,{className:"m-4",style:{width:"auto"},children:(0,k.jsxs)(m.Z,{width:"100%",hover:!0,children:[(0,k.jsx)("thead",{children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{width:"30%",children:"Name"}),(0,k.jsx)("th",{width:"20%",children:"freigegeben"}),(0,k.jsx)("th",{width:"20%",children:"\xc4nderufrengsdatum"}),(0,k.jsx)("th",{width:"20%",children:"Erstelldatum"}),(0,k.jsx)("th",{width:"10%"})]})}),(0,k.jsx)("tbody",{children:F.map((function(e){return(0,k.jsx)(w,{p:e,editMenu:[["nicht mehr freigeben",function(){J(null,e.id)}]]},e.id)}))})]})})})]})}),(0,k.jsx)(b,{refreshPage:U,setSortName:function(e){return o(e)}})]})}function w(e){var t=(0,c.useState)(!1),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(),u=(0,s.Z)(l,2),d=u[0],f=u[1],p=(0,c.useState)(!1),x=(0,s.Z)(p,2),h=x[0],g=x[1];return(0,c.useEffect)((function(){var t=function(){var e=(0,r.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.user.get({id:t});case 2:n=e.sent,f("".concat(n[0].first_name," ").concat(n[0].last_name));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.p.shared_id>0&&4===e.p.status?t(e.p.user_id):e.p.shared_id>0&&1===e.p.status&&(t(e.p.shared_id),g(!0))}),[]),(0,k.jsxs)("tr",{style:{height:"49px"},className:h?"text-primary":null,onMouseEnter:function(){o(!0)},onMouseLeave:function(){o(!1)},children:[(0,k.jsx)("td",{children:(0,k.jsx)("b",{style:{cursor:e.openProject?"pointer":"default"},onClick:function(){e.openProject&&e.openProject(e.p.id)},children:e.p.name})}),(0,k.jsx)("td",{children:d}),(0,k.jsx)("td",{children:e.p.u_date.substring(0,16)}),(0,k.jsx)("td",{children:e.p.c_date.substring(0,16)}),(0,k.jsx)("td",{style:{minWidth:"115px"},children:(0,k.jsxs)(v.Z,{style:{display:i?"block":"none"},children:[(0,k.jsx)(v.Z.Toggle,{size:"sm",variant:"outline-primary",children:"bearbeiten"}),(0,k.jsxs)(v.Z.Menu,{variant:"dark",children:[e.editMenu.map((function(e){return(0,k.jsx)(v.Z.Item,{onClick:function(){e[1]()},children:e[0]},e[0])})),e.deleteProject?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(v.Z.Divider,{}),(0,k.jsx)(v.Z.Item,{onClick:function(){e.deleteProject(e.p.id)},children:"l\xf6schen"})]}):null]})]})})]})}function b(e){var t=(0,c.useState)(!1),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(!1),u=(0,s.Z)(l,2),p=u[0],x=u[1],h=[["Sortieren nach",function(){o(!0)}],["neues Projekt erstellen",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x(!0);case 1:case"end":return e.stop()}}),e)})))]];return(0,k.jsxs)(d.Z,{fixed:"bottom",bg:"light",children:[(0,k.jsx)(Z.v0,{show:p,title:"Projekt-Name ausw\xe4hlen",msg:"Geben Sie einen Namen f\xfcr das neue Projekt ein:",input:"Neues Projekt",onReplay:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1==n||""==n){t.next=3;break}return t.next=3,j.Q.project.save({name:n,user_id:j.Q.me.id,status:1});case 3:return t.next=6,e.refreshPage();case 6:x(!1);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),(0,k.jsx)(Z.v0,{show:i,title:"Sortierung der Projekte",msg:"Wie sollen die Projekte sortiert werden? Nach ...",dropDown:[["name","Name"],["u_date","\xc4nderungsdatum"],["c_date","Erstelldatum"]],onReplay:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Te("projectSort",n),e.setSortName(n),o(!1);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),(0,k.jsxs)(f.Z,{fluid:!0,children:[(0,k.jsx)(d.Z.Collapse,{className:"justify-content-start"}),(0,k.jsx)(d.Z.Collapse,{className:"justify-content-end",children:(0,k.jsx)(d.Z.Text,{children:(0,k.jsx)(Z.vW,{menuItems:h})})})]})]})}var _=n(1413),C=n(2982),S=n(9743),I=n(2677),N=n(5987),Q=n(1694),E=n.n(Q),T=n(162);function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.Hz,n=[];return Object.entries(e).forEach((function(e){var r=(0,s.Z)(e,2),i=r[0],a=r[1];null!=a&&("object"===typeof a?t.forEach((function(e){var t=a[e];if(null!=t){var r="xs"!==e?"-".concat(e):"";n.push("".concat(i).concat(r,"-").concat(t))}})):n.push("".concat(i,"-").concat(a)))})),n}var B=["as","bsPrefix","className","direction","gap"],z=c.forwardRef((function(e,t){var n=e.as,r=void 0===n?"div":n,s=e.bsPrefix,i=e.className,a=e.direction,c=e.gap,o=(0,N.Z)(e,B);s=(0,T.vE)(s,"horizontal"===a?"hstack":"vstack");var l=(0,T.pi)();return(0,k.jsx)(r,(0,_.Z)((0,_.Z)({},o),{},{ref:t,className:E().apply(void 0,[i,s].concat((0,C.Z)(D({gap:c,breakpoints:l}))))}))}));z.displayName="Stack";var A=z,M=n(4775),L=n(3350),R=n(3360),O=n(9140),F=n(6144),K=n(5316),P=n(8949),V=["bsPrefix","bg","pill","text","className","as"],X=c.forwardRef((function(e,t){var n=e.bsPrefix,r=e.bg,s=e.pill,i=e.text,a=e.className,c=e.as,o=void 0===c?"span":c,l=(0,N.Z)(e,V),u=(0,T.vE)(n,"badge");return(0,k.jsx)(o,(0,_.Z)((0,_.Z)({ref:t},l),{},{className:E()(a,u,s&&"rounded-pill",i&&"text-".concat(i),r&&"bg-".concat(r))}))}));X.displayName="Badge",X.defaultProps={bg:"primary",pill:!1};var G=X;function U(e){var t=(0,c.useState)("?"),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=(0,c.useState)(!0),u=(0,s.Z)(a,2),d=u[0],p=u[1],x=(0,c.useState)(!1),h=(0,s.Z)(x,2),g=h[0],m=h[1],v=(0,c.useState)(""),j=(0,s.Z)(v,2),Z=j[0],y=j[1];return(0,c.useEffect)((function(){var e=new ResizeObserver((function(e){!0===d&&e[0].contentRect.width<1e3&&p(!1),!1===d&&e[0].contentRect.width>=1e3&&p(!0)}));return e.observe(document.getElementById("cardBox")),function(){document.getElementById("cardBox")&&e.unobserve(document.getElementById("cardBox"))}}),[d]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(re,{updateArticles:e.updateArticles,show:e.showImport,project:e.project,onReplay:function(t){t&&e.updateSections(),e.setShowImport(!1)}}),(0,k.jsx)(f.Z,{fluid:!0,children:(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{id:"cardBox",children:(0,k.jsx)(A,{gap:5,children:e.filterLst.map((function(t){return(0,k.jsx)(H,{setChangeZettelWork:e.setChangeZettelWork,updateSections:e.updateSections,wideScreen:d,setRessourceView:function(e){!function(e){g||m(!0),y(e)}(e)},project:e.project,sId:t},t)}))})}),g?(0,k.jsxs)(I.Z,{children:[(0,k.jsx)("iframe",{src:Z,style:{position:"fixed",top:"0px",left:"50%",height:"100%",width:"50%"}}),(0,k.jsx)(o.G,{icon:l.nYk,style:{color:"var(--bs-danger)",fontSize:"24px",zIndex:"99999999",position:"fixed",top:"80px",right:"30px"},onClick:function(){m(!1)}})]}):null]})}),(0,k.jsx)(W,{setFilterSearchIds:e.setFilterSearchIds,setLimitFilterResults:function(t){e.setLimitFilterResults(t)},setActiveTabKey:e.setSectionsMenuActiveTabKey,activeTabKey:e.sectionsMenuActiveTabKey,project:e.project,filterTags:e.filterTags,setFilterTags:function(t){e.setFilterTags(t)},tagLst:e.tagLst,show:null!=e.sectionsMenuActiveTabKey,onHide:function(){e.setSectionsMenuActiveTabKey(null)},updateSections:function(){e.updateSections()}}),(0,k.jsxs)("div",{style:{fontSize:"95%",position:"fixed",display:"flex",justifyContent:"space-between",bottom:"0px",left:0,right:0,backgroundColor:"#f8f9fa",padding:"5px 20px"},children:[(0,k.jsx)("div",{style:{display:"flex",justifyContent:"space-around",gap:"10px"},children:0===e.filterSearchIds.length&&e.filterTags&&e.filterTags.length>0?e.filterTags.map((function(e){return(0,k.jsx)("div",{style:{cursor:"default",backgroundColor:e.exclude?"rgb(248,248,248)":e.color,fontWeight:"bold",color:e.exclude?e.color:"rgba(255,255,255, 0.8)",border:"1px solid ".concat(e.color),margin:"1px 2px",padding:"1px 10px 1px 13px",borderRadius:"18px"},children:e.name})})):e.filterSearchIds.length?(0,k.jsx)("div",{children:(0,k.jsx)("small",{children:(0,k.jsx)("i",{children:"Suchergebnisse"})})}):(0,k.jsx)("div",{style:{color:"gray"},children:(0,k.jsx)("small",{children:(0,k.jsx)("i",{children:"kein Filter"})})})}),(0,k.jsxs)("div",{children:[(0,k.jsx)("input",{style:{background:"none",border:"none",outline:"none",width:"60px",textAlign:"right"},id:"editor_zettel_current_active",value:r,onChange:function(e){i(e.target.value)},onKeyUp:function(e){if(13===e.keyCode){var t=document.getElementsByClassName("editor_zettel_card");t[parseInt(r)-1]&&t[parseInt(r)-1].scrollIntoView({behavior:"auto",block:"center"})}}})," / ",e.filterSearchIds.length>0?e.filterSearchIds.length:e.filterLst.length]})]})]})}function W(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(0),p=(0,s.Z)(d,2),y=p[0],w=p[1],b=(0,c.useState)(""),_=(0,s.Z)(b,2),C=_[0],N=_[1],Q=(0,c.useState)(""),E=(0,s.Z)(Q,2),T=E[0],D=E[1],B=(0,c.useState)([]),z=(0,s.Z)(B,2),A=z[0],O=z[1],F=(0,c.useState)(!0),K=(0,s.Z)(F,2),P=K[0],V=K[1],X=(0,c.useState)(!1),G=(0,s.Z)(X,2),U=G[0],W=G[1];(0,c.useEffect)((function(){e.show&&H()}),[e.show]);var H=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.tags.get({project_id:e.project.id});case 2:n=t.sent,r=[],s=(0,x.Z)(n),t.prev=5,s.s();case 7:if((i=s.n()).done){t.next=16;break}return c=i.value,t.next=11,j.Q.tag_lnks.get({tag_id:c.id},{count:!0});case 11:o=t.sent,c.sections=o[0].count,r.push(c);case 14:t.next=7;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(5),s.e(t.t0);case 21:return t.prev=21,s.f(),t.finish(21);case 24:u(r);case 25:case"end":return t.stop()}}),t,null,[[5,18,21,24]])})));return function(){return t.apply(this,arguments)}}(),J=function(){var e=(0,r.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Soll das Schlagwort '".concat(t.name,"' wirklich gel\xf6scht werden? Es wird aus allen Stellen entfernt!"))){e.next=10;break}return e.next=3,j.Q.tag_lnks.get({tag_id:t.id},{select:["id"]});case 3:return n=e.sent,e.next=6,j.Q.tag_lnks.delete(n.map((function(e){return e.id})));case 6:return e.next=8,j.Q.tags.delete(t.id);case 8:return e.next=10,H();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,k.jsxs)(M.Z,{show:e.show,onHide:function(){e.updateSections(),e.onHide()},children:[(0,k.jsx)(M.Z.Header,{closeButton:!0,children:(0,k.jsx)(M.Z.Title,{})}),(0,k.jsxs)(M.Z.Body,{children:[(0,k.jsx)(Z.v0,{show:y>0,title:"Schlagwort umbenennen",msg:"Geben Sie einen neuen Namen f\xfcr das Schlagwort ein:",input:C,onReplay:function(){var e=(0,r.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.map((function(e){return e.name.toLowerCase()})),-1==t||""==t){e.next=10;break}if(!n.includes(t.toLowerCase())){e.next=6;break}alert("Der Name '".concat(t,"' wird bereits verwendet!")),e.next=10;break;case 6:return e.next=8,j.Q.tags.save({id:y,name:t});case 8:return e.next=10,H();case 10:w(0);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,k.jsxs)(h.Z,{defaultActiveKey:"filter",className:"mb-3",activeKey:e.activeTabKey,onSelect:function(t){e.setActiveTabKey(t)},children:[(0,k.jsx)(g.Z,{eventKey:"search",title:"Suche",children:(0,k.jsxs)(f.Z,{children:[(0,k.jsx)(S.Z,{children:(0,k.jsx)(I.Z,{children:(0,k.jsxs)("div",{style:{display:"flex",gap:"5px"},children:[(0,k.jsx)(L.Z.Control,{placeholder:"Suche...",size:"sm",type:"text",value:T,onChange:function(){var t=(0,r.Z)(a().mark((function t(n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(D(n.target.value),""!==n.target.value){t.next=5;break}O([]),t.next=13;break;case 5:return r=[{c:"project_id",o:"=",v:e.project.id}],P&&r.push({c:"ref",o:"LIKE",v:"*".concat(n.target.value,"*")}),U&&r.push({c:"text",o:"LIKE",v:"*".concat(n.target.value,"*")}),t.t0=O,t.next=11,j.Q.sections.search(r,{select:["id","ref","text"]});case 11:t.t1=t.sent,(0,t.t0)(t.t1);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),(0,k.jsxs)(v.Z,{autoClose:"outside",children:[(0,k.jsx)(v.Z.Toggle,{size:"sm",tabIndex:"-1",variant:"outline-secondary",children:(0,k.jsx)(o.G,{icon:l.gr5})}),(0,k.jsxs)(v.Z.Menu,{children:[(0,k.jsx)(v.Z.Header,{children:"Suchen in:"}),(0,k.jsx)(v.Z.Item,{className:P?"text-primary":null,onClick:function(){V(!P)},children:"Zitiertitel"}),(0,k.jsx)(v.Z.Item,{className:U?"text-primary":null,onClick:function(){W(!U)},children:"Belegtext"})]})]})]})})}),A.length>0?(0,k.jsx)(S.Z,{className:"mt-1",children:(0,k.jsx)(I.Z,{style:{textAlign:"right"},children:(0,k.jsx)("small",{className:"text-primary",style:{cursor:"pointer"},onClick:function(){e.setFilterSearchIds([]),e.setFilterSearchIds(A.map((function(e){return e.id})))},children:"Auswahl anzeigen"})})}):null,A.map((function(e){return(0,k.jsx)(S.Z,{children:(0,k.jsxs)(I.Z,{children:[(0,k.jsx)("hr",{}),(0,k.jsx)("span",{dangerouslySetInnerHTML:(0,Z.rg)(P?e.ref.replace(new RegExp("(".concat(T,")"),"gi"),"<strong>$1</strong>"):e.ref)}),(0,k.jsx)("p",{children:(0,k.jsx)("small",{dangerouslySetInnerHTML:(0,Z.rg)(U?e.text.replace(new RegExp("(".concat(T,")"),"gi"),"<strong>$1</strong>"):e.text)})})]})})}))]})}),(0,k.jsx)(g.Z,{eventKey:"filter",title:"Filter",children:(0,k.jsxs)(f.Z,{children:[(0,k.jsx)(S.Z,{className:"mb-3",children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(Y,{filterTags:e.filterTags,setFilterTags:function(t){e.setFilterTags(t)},project:e.project})})}),(0,k.jsxs)(S.Z,{className:"mb-4",children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{children:(0,k.jsx)(R.Z,{style:{width:"100%"},onClick:function(){e.updateSections()},children:"Stellen filtern"})})]})]})}),(0,k.jsx)(g.Z,{eventKey:"tags",title:"Schlagworte",children:(0,k.jsx)(m.Z,{children:(0,k.jsx)("tbody",{children:i.map((function(t){return(0,k.jsxs)("tr",{children:[(0,k.jsx)("td",{children:(0,k.jsx)(L.Z.Control,{style:{display:"inline"},size:"sm",type:"color",id:"exampleColorInput",defaultValue:t.color,title:"Choose your color",onChange:function(){var e=(0,r.Z)(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.tags.save({id:t.id,color:n.target.value});case 2:return e.next=4,H();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}),(0,k.jsx)("td",{children:(0,k.jsx)("b",{style:{marginLeft:"10px",color:t.color,cursor:"pointer"},onClick:function(){e.setFilterTags([t]),e.setActiveTabKey("filter")},children:t.name})}),(0,k.jsx)("td",{children:t.sections}),(0,k.jsx)("td",{onClick:(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.tags.save({id:t.id,display:1===t.display?0:1});case 2:return e.next=4,H();case 4:case"end":return e.stop()}}),e)}))),children:1===t.display?(0,k.jsx)(o.G,{className:"text-primary",style:{cursor:"pointer"},icon:l.Mdf}):(0,k.jsx)(o.G,{className:"text-secondary",style:{cursor:"pointer"},icon:l.Aq})}),(0,k.jsx)("td",{children:(0,k.jsx)(o.G,{icon:l.Yai,style:{cursor:"pointer",color:"var(--bs-primary)"},onClick:function(){N(t.name),w(t.id)}})}),(0,k.jsx)("td",{children:(0,k.jsx)(o.G,{icon:l.Vui,style:{cursor:"pointer",color:"var(--bs-primary)"},onClick:function(){J(t)}})})]},t.id)}))})})})]})]})]})}function H(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(!1),f=(0,s.Z)(d,2),p=f[0],h=f[1],g=(0,c.useState)(!1),m=(0,s.Z)(g,2),y=m[0],w=m[1],b=(0,c.useState)(!1),_=(0,s.Z)(b,2),C=_[0],N=_[1],Q=(0,c.useState)(""),E=(0,s.Z)(Q,2),T=E[0],D=E[1],B=(0,c.useState)(null),z=(0,s.Z)(B,2),A=z[0],M=z[1],R=(0,c.useState)(""),F=(0,s.Z)(R,2),K=F[0],P=F[1],V=(0,c.useState)(""),X=(0,s.Z)(V,2),G=X[0],U=X[1],W=(0,c.useState)(9999),H=(0,s.Z)(W,2),Y=H[0],q=H[1],$=(0,c.useState)(!1),te=(0,s.Z)($,2),ne=te[0],re=te[1],se=(0,c.useState)([]),ie=(0,s.Z)(se,2),ae=ie[0],ce=ie[1],oe=(0,c.useState)([]),le=(0,s.Z)(oe,2),ue=le[0],de=le[1],fe=(0,c.useState)({}),pe=(0,s.Z)(fe,2),xe=pe[0],he=pe[1],ge=(0,c.useState)(!1),me=(0,s.Z)(ge,2),ve=me[0],je=me[1],Ze=(0,c.useRef)(),ke=function(){document.getElementById("s_"+e.sId).scrollIntoView({block:"center"})};(0,Z.S1)({target:Ze,onIntersect:function(e,t){(0,s.Z)(e,1)[0].isIntersecting&&(je(!0),t.unobserve(Ze.current))}}),(0,c.useEffect)((function(){ve?(ye(),we()):(M(null),ce([]))}),[ve]),(0,c.useEffect)((function(){ve&&M(j.Q.url+xe.img+"".concat(ne?"v":"",".jpg"))}),[ne]);var ye=function(){var t=(0,r.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({id:e.sId});case 2:return(n=t.sent)[0].img?M(j.Q.url+n[0].img+"".concat(ne?"v":"",".jpg")):M(null),P(n[0].ref),U(n[0].text),D(n[0].comment),null!=n[0].comment&&""!=n[0].comment&&h(!0),he(n[0]),q(n[0].date_sort),N(!0),t.t0=u,t.next=14,j.Q.edition.get({work_id:n[0].work_id},{select:["id","label","url"]});case 14:t.t1=t.sent,(0,t.t0)(t.t1);case 16:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),we=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.tags.get({project_id:e.project.id});case 2:return n=t.sent,t.next=5,j.Q.tag_lnks.get({section_id:e.sId});case 5:r=t.sent,s=[],i=(0,x.Z)(r);try{for(o=function(){var e=c.value,t=n.findIndex((function(t){return t.id===e.tag_id}));if(-1===t)throw"ERROR! CANNOT FIND TAG INDEX!";s.push(n[t]),n.splice(t,1)},i.s();!(c=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}de(n),ce(s);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,k.jsxs)(O.Z,{ref:Ze,className:e.wideScreen?"largeScreen editor_zettel_card":"editor_zettel_card",id:"s_"+e.sId,style:{width:"80%",margin:"auto"},onFocus:function(t){var n=document.getElementById("editor_zettel_current_active");if(n)for(var r=document.getElementsByClassName("editor_zettel_card"),s=0;s<r.length;s++)if(r[s].id==="s_"+e.sId){n.value=s+1;break}},children:[A?(0,k.jsx)(O.Z.Img,{style:{aspectRatio:"10/7"},variant:"top",src:A}):null,(0,k.jsxs)(O.Z.Body,{className:"editor_zettel_CardBox",children:[(0,k.jsx)(S.Z,{className:"mb-3",style:{marginBottom:"47px"},children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(L.Z.Control,{placeholder:"Zitiertitel...",onFocus:function(){ke()},size:"sm",type:"text",value:K||"",onChange:function(e){P(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sId,ref:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})}),(0,k.jsx)(S.Z,{className:"mb-3",children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(L.Z.Control,{placeholder:"Text der Stelle...",onFocus:function(){ke()},as:"textarea",rows:3,style:{minHeight:"120px",fontSize:"95%"},value:G||"",onChange:function(e){U(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sId,text:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})}),y?(0,k.jsx)(S.Z,{className:"mb-3",children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(L.Z.Control,{value:Y,onChange:function(e){e.target.value.search(/^\d+$/g)>-1?N(!0):N(!1),q(e.target.value)},style:{textAlign:"right"},isValid:C,onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!C){t.next=3;break}return t.next=3,j.Q.sections.save({id:e.sId,date_sort:n.target.value});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})}):null,p?(0,k.jsx)(S.Z,{className:"mb-3",children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(L.Z.Control,{className:"mt-2",placeholder:"Schreiben Sie einen Kommentar...",onFocus:function(){ke()},as:"textarea",rows:3,style:{fontSize:"95%"},value:T||"",onChange:function(e){D(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sId,comment:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})}):null,(0,k.jsx)(S.Z,{style:{marginBottom:"47px"},children:(0,k.jsx)(I.Z,{children:(0,k.jsx)(ee,{isVisible:ve,loadTags:(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we();case 2:case"end":return e.stop()}}),e)}))),tags:ae,project:e.project,s:xe,unusedTags:ue,centerSection:function(){ke()}})})}),(0,k.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"15px",margin:"0 0.4rem 0 0.4rem",position:"absolute",bottom:"10px",left:"10px",right:"10px"},children:[(0,k.jsx)(J,{setRessourceView:function(t){e.setRessourceView(t)},ressources:i}),(0,k.jsxs)(v.Z,{children:[(0,k.jsx)(v.Z.Toggle,{tabIndex:"-1",variant:"outline-secondary",children:(0,k.jsx)(o.G,{icon:l.gr5})}),(0,k.jsxs)(v.Z.Menu,{children:[(0,k.jsx)(v.Z.Item,{onClick:function(){localStorage.setItem(j.Q.project_name+"_searchBox_zettel",'[[{"id":0,"c":"id","o":"=","v":"'.concat(xe.zettel_id,'"}],1,["id"]]')),window.open("/static/index.html?project=".concat(j.Q.project_name,"&app=db&site=zettel"))},children:"Zettel bearbeiten"}),(0,k.jsx)(v.Z.Item,{onClick:function(){re(!ne)},children:"Zettel drehen"}),(0,k.jsx)(v.Z.Divider,{}),(0,k.jsx)(v.Z.Item,{onClick:(0,r.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.work.get({id:xe.work_id},{select:["ac_web"]});case 2:n=t.sent,e.setChangeZettelWork({value:n[0].ac_web,id:xe.work_id,section_id:e.sId});case 4:case"end":return t.stop()}}),t)}))),children:"verknpft. Werk \xe4ndern"}),(0,k.jsx)(v.Z.Item,{onClick:function(){w(!y)},children:y?"Datierung ausblenden":"Datierung anzeigen"}),(0,k.jsx)(v.Z.Item,{onClick:function(){h(!0)},children:"Kommentar hinzuf\xfcgen"}),(0,k.jsx)(v.Z.Divider,{}),(0,k.jsx)(v.Z.Item,{onClick:(0,r.Z)(a().mark((function t(){var n,r,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({id:e.sId});case 2:return delete(n=t.sent).id,t.next=6,j.Q.sections.save(n);case 6:return r=t.sent,e.updateSections(!0),t.next=10,(0,Z._v)(300);case 10:(s=document.getElementById("s_".concat(r)))&&s.scrollIntoView({behavior:"auto",block:"center"});case 12:case"end":return t.stop()}}),t)}))),children:"Stelle duplizieren"}),(0,k.jsx)(v.Z.Item,{onClick:(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.confirm("Soll die Stelle aus dem Projekt entfernt werden? Alle \xc4nderungen gehen verloren.")){t.next=4;break}return t.next=3,j.Q.sections.delete(e.sId);case 3:e.updateSections();case 4:case"end":return t.stop()}}),t)}))),className:"text-danger",children:"Stelle l\xf6schen"})]})]})]})]})]})}function J(e){var t=(0,c.useState)(null),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=(0,c.useState)(null),o=(0,s.Z)(a,2),l=o[0],u=o[1],d=function(t){switch(console.log(t),j.Q.options.openExternally){case 0:default:e.setRessourceView(t);break;case 1:window.open(t);break;case 2:j.Q.sendEcho({type:"edition",url:t})}};return(0,c.useEffect)((function(){0===e.ressources.length?i(null):1===e.ressources.length?i((0,k.jsx)(R.Z,{tabIndex:"-1",size:"sm",variant:"outline-dark",onClick:function(){d(null===e.ressources[0].url||""===e.ressources[0].url?"/static/index.html?project=".concat(j.Q.project_name,"&app=argos&site=edition&id=").concat(e.ressources[0].id):e.ressources[0].url)},children:e.ressources[0].label})):u(e.ressources[0])}),[e.ressources]),(0,c.useEffect)((function(){null!=l&&i((0,k.jsxs)(v.Z,{as:F.Z,children:[(0,k.jsx)(R.Z,{size:"sm",variant:"outline-dark",style:{width:"100%"},onClick:function(){d(null===l.url||""===l.url?"/static/index.html?project=".concat(j.Q.project_name,"&app=argos&site=edition&id=").concat(l.id):l.url)},children:l.label}),(0,k.jsx)(v.Z.Toggle,{split:!0,size:"sm",variant:"dark",id:"dropdown-split-basic"}),(0,k.jsx)(v.Z.Menu,{children:e.ressources.map((function(e){return(0,k.jsx)(v.Z.Item,{onClick:function(){u(e)},children:e.label},e.id)}))})]}))}),[l]),r}function Y(e){var t=(0,c.useState)(0),n=(0,s.Z)(t,2),i=n[0],o=n[1];(0,c.useEffect)((function(){}),[e.filterTags]);var l=function(t){e.setFilterTags(e.filterTags.filter((function(e){return e.id!==t.id})))},u=function(){var t=(0,r.Z)(a().mark((function t(n){var r,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=structuredClone(e.filterTags),t.next=3,j.Q.tags.get({project_id:e.project.id,name:n});case 3:s=t.sent,2===i&&(s[0].exclude=!0),r.push(s[0]),e.setFilterTags(r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d="1px solid #ced4da",f=null;return 1===i?(d="1px solid var(--bs-yellow)",f="#ffecb1"):2===i&&(d="1px solid var(--bs-teal)",f="#e2f7ed"),(0,k.jsxs)("div",{className:"mt-2",id:"filter_box",style:{border:d,backgroundColor:f,padding:"2px 5px",display:"flex",alignContent:"flex-start",alignItems:"flex-start",flexWrap:"wrap",minHeight:"220px",borderRadius:"0.25rem",fontSize:"100%"},onClick:function(){var e=document.getElementById("filter_box");e.children[e.children.length-1].children[0].focus()},children:[e.filterTags.map((function(e){return(0,k.jsx)($,{t:e,removeTag:function(e){l(e)}},e.id)})),(0,k.jsx)(q,{inputMode:i,setInputMode:function(e){o(e)},tags:e.filterTags,addTag:u,removeTag:function(e){l(e)},project:e.project})]})}function q(e){var t=(0,c.useState)(""),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)([]),u=(0,s.Z)(l,2),d=u[0],f=u[1],p=(0,c.useState)(-1),x=(0,s.Z)(p,2),h=x[0],g=x[1],m=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.inputMode&&2!==e.inputMode){t.next=9;break}return n=e.tags.map((function(e){return e.name})),t.next=4,j.Q.tags.get({project_id:e.project.id});case 4:r=t.sent,s=r.filter((function(e){return!n.includes(e.name)})),f(""===i?s:s.filter((function(e){return e.name.toLowerCase().indexOf(i.toLowerCase())>-1}))),t.next=10;break;case 9:f(""===i?e.tags:e.tags.filter((function(e){return e.name.toLowerCase().indexOf(i.toLowerCase())>-1})));case 10:g(-1);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){(d.length>0||""!==i)&&m()}),[e.tags,i,e.inputMode]);var v=function(){var t=(0,r.Z)(a().mark((function t(n){var r,s,i=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>1&&void 0!==i[1]&&i[1],0!==e.inputMode&&2!==e.inputMode){t.next=8;break}if(e.tags.find((function(e){return e.name.toLowerCase()===n.toLowerCase()}))){t.next=6;break}return t.next=5,e.addTag(n);case 5:2===e.inputMode&&e.setInputMode(0);case 6:t.next=10;break;case 8:(s=e.tags.find((function(e){return e.name.toLowerCase()===n.toLowerCase()})))&&(e.removeTag(s),e.setInputMode(0));case 10:o(""),r?f([]):m();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Z="#ced4da",y=null;return 1===e.inputMode?(Z="var(--bs-yellow)",y="#ffecb1"):2===e.inputMode&&(Z="var(--bs-teal)",y="#e2f7ed"),(0,k.jsxs)("div",{style:{width:"300px",position:"relative",display:"inline-block"},children:[(0,k.jsx)("input",{value:i,onChange:function(e){o(e.target.value)},onFocus:function(){m()},onBlur:function(){o(""),f([]),e.inputMode>0&&e.setInputMode(0)},type:"text",style:{background:"none",outline:"none",border:"none",margin:"1px 2px",padding:"4px 10px"},onKeyDown:function(t){!function(t){13===t.keyCode&&1===d.length?(t.preventDefault(),v(d[0].name)):27===t.keyCode&&d.length>0?(t.preventDefault(),f([])):190===t.keyCode&&""===t.target.value?(t.preventDefault(),2!==e.inputMode?e.setInputMode(2):e.setInputMode(0)):173===t.keyCode&&""===t.target.value?(t.preventDefault(),1!==e.inputMode?e.setInputMode(1):e.setInputMode(0)):40===t.keyCode?h+1>=d.length?g(0):g(h+1):38===t.keyCode?g(h-1<0?d.length-1:h-1):13===t.keyCode&&(t.preventDefault(),h>-1?v(d[h].name):""!==t.target.value&&v(t.target.value))}(t)}}),d.length>0&&(0,k.jsx)("div",{className:"autocomplete-items",style:{borderColor:Z},children:d.map((function(e,t){return(0,k.jsx)("div",{style:{backgroundColor:y,borderColor:Z},onMouseDown:(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(e.name,!0);case 2:case"end":return t.stop()}}),t)}))),className:t===h?"autocomplete-active":"",children:e.name},e.id)}))})]})}function $(e){return(0,k.jsxs)("div",{style:{cursor:"default",backgroundColor:e.t.exclude?"rgb(248,248,248)":e.t.color,fontWeight:"bold",color:e.t.exclude?e.t.color:"rgba(255,255,255, 0.8)",border:"1px solid ".concat(e.t.color),margin:"1px 2px",padding:"3px 15px 3px 18px",borderRadius:"18px"},children:[e.t.name,(0,k.jsx)(o.G,{onClick:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.stopPropagation(),e.removeTag(e.t);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),style:{cursor:"pointer",margin:"4px 0 0 9px"},icon:l.g82})]})}function ee(e){var t=(0,c.useState)(!0),n=(0,s.Z)(t,2),i=n[0],o=n[1];return(0,k.jsxs)("div",{className:"mt-2",id:"tagBox_"+e.s.id,style:{border:i?"1px solid #ced4da":"1px solid var(--bs-yellow)",backgroundColor:i?null:"#ffecb1",padding:"2px 5px",display:"flex",alignItems:"flex-start",flexWrap:"wrap",minHeight:"110px",borderRadius:"0.25rem",fontSize:"100%"},onClick:function(e){var t=e.target.querySelector("input");t&&t.focus()},children:[e.isVisible&&e.tags.map((function(t){return(0,k.jsx)(ne,{t:t,sectionId:e.s.id,loadTags:(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadTags();case 2:case"end":return t.stop()}}),t)})))},t.id)})),(0,k.jsx)(te,{inputMode:i,setInputMode:function(e){o(!i)},project:e.project,tags:e.tags,loadTags:(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadTags();case 2:case"end":return t.stop()}}),t)}))),sectionId:e.s.id,centerSection:function(){e.centerSection()}})]})}function te(e){var t=(0,c.useState)(!1),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(""),u=(0,s.Z)(l,2),d=u[0],f=u[1],p=(0,c.useState)([]),x=(0,s.Z)(p,2),h=x[0],g=x[1],m=(0,c.useState)(-1),v=(0,s.Z)(m,2),Z=v[0],y=v[1],w=function(){var t=(0,r.Z)(a().mark((function t(n){var r,s,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.inputMode){t.next=9;break}return r=e.tags.map((function(e){return e.name})),t.next=4,j.Q.tags.get({project_id:e.project.id});case 4:s=t.sent,i=s.filter((function(e){return!r.includes(e.name)})),g(""===n?i.sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()})):i.filter((function(e){return e.name.toLowerCase().indexOf(n.toLowerCase())>-1})).sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()}))),t.next=10;break;case 9:g(""===n?e.tags.sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()})):e.tags.filter((function(e){return e.name.toLowerCase().indexOf(n.toLowerCase())>-1})).sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()})));case 10:y(-1);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){i&&w(d)}),[i,e.tags,d,e.inputMode]);var b=function(){var t=(0,r.Z)(a().mark((function t(n){var r,s,i,c,o,l,u=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u.length>1&&void 0!==u[1]&&u[1],!e.inputMode){t.next=27;break}if(e.tags.find((function(e){return e.name.toLowerCase()===n.toLowerCase()}))){t.next=25;break}if(r=h.find((function(e){return e.name.toLowerCase()===n.toLowerCase()})),s=0,!r){t.next=11;break}return s=r.id,t.next=9,j.Q.tag_lnks.save({tag_id:r.id,section_id:e.sectionId,project_id:e.project.id});case 9:t.next=17;break;case 11:return t.next=13,j.Q.tags.save({name:n,color:se(),project_id:e.project.id,user_id:e.project.user_id,shared_id:e.project.shared_id,display:1});case 13:return i=t.sent,s=i,t.next=17,j.Q.tag_lnks.save({tag_id:i,section_id:e.sectionId,project_id:e.project.id});case 17:return t.next=19,j.Q.tag_lnks.search([{c:"tag_id",o:"=",v:s},{c:"article_id",o:">",v:0}],{select:["article_id"]});case 19:if(!((c=t.sent).length>0)){t.next=23;break}return t.next=23,j.Q.sections.save({id:e.sectionId,article_id:c[0].article_id});case 23:return t.next=25,e.loadTags();case 25:t.next=43;break;case 27:if(!(o=e.tags.find((function(e){return e.name.toLowerCase()===n.toLowerCase()})))){t.next=43;break}return t.next=31,j.Q.tag_lnks.get({tag_id:o.id,section_id:e.sectionId});case 31:return l=t.sent,t.next=34,j.Q.tag_lnks.delete(l[0].id);case 34:return t.next=36,j.Q.tag_lnks.search([{c:"tag_id",o:"=",v:o.id},{c:"article_id",o:">",v:0}],{select:["article_id"]});case 36:if(!(t.sent.length>0)){t.next=40;break}return t.next=40,j.Q.sections.save({id:e.sectionId,article_id:null});case 40:return t.next=42,e.loadTags();case 42:e.setInputMode();case 43:f(""),g([]);case 45:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,k.jsxs)("div",{style:{width:"300px",position:"relative",display:"inline-block"},children:[(0,k.jsx)("input",{value:d,onChange:function(e){f(e.target.value)},onFocus:function(){o(!0),e.centerSection()},onBlur:function(){o(!1),f(""),g([]),e.inputMode||e.setInputMode()},type:"text",style:{background:"none",outline:"none",border:"none",margin:"1px 2px",padding:"4px 10px"},onKeyDown:function(t){!function(t){13===t.keyCode&&1===h.length?(t.preventDefault(),b(h[0].name)):27===t.keyCode?g([]):190===t.keyCode&&""===t.target.value?t.preventDefault():173===t.keyCode&&""===t.target.value?(t.preventDefault(),e.setInputMode()):40===t.keyCode?Z+1>=h.length?y(0):y(Z+1):38===t.keyCode?y(Z-1<0?h.length-1:Z-1):13===t.keyCode&&(t.preventDefault(),Z>-1?b(h[Z].name):""!==t.target.value&&b(t.target.value))}(t)}}),h.length>0&&(0,k.jsx)("div",{className:"autocomplete-items",style:{borderColor:e.inputMode?null:"var(--bs-yellow)"},children:h.map((function(t,n){return(0,k.jsx)("div",{style:{backgroundColor:e.inputMode?null:"#ffecb1",borderColor:e.inputMode?null:"var(--bs-yellow)"},onMouseDown:(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(t.name,!0);case 2:case"end":return e.stop()}}),e)}))),className:n===Z?"autocomplete-active":"",children:t.name},t.id)}))})]})}function ne(e){return(0,k.jsxs)("div",{style:{cursor:"default",backgroundColor:e.t.color,fontWeight:"bold",color:"rgba(255,255,255, 0.8)",margin:"1px 2px",padding:"3px 15px 3px 18px",borderRadius:"18px"},children:[e.t.name,(0,k.jsx)(o.G,{onClick:function(){var t=(0,r.Z)(a().mark((function t(n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.stopPropagation(),t.next=3,j.Q.tag_lnks.get({tag_id:e.t.id,section_id:e.sectionId},{select:["id"]});case 3:return r=t.sent,t.next=6,j.Q.tag_lnks.delete(r[0].id);case 6:return t.next=8,e.loadTags();case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),className:"removeTagButton",icon:l.g82})]})}function re(e){var t=(0,c.useState)("lemma"),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(""),p=(0,s.Z)(d,2),h=p[0],g=p[1],m=(0,c.useState)(null),v=(0,s.Z)(m,2),y=v[0],w=v[1],b=(0,c.useState)(null),_=(0,s.Z)(b,2),C=_[0],S=_[1],I=(0,c.useState)(0),N=(0,s.Z)(I,2),Q=N[0],E=N[1],T=(0,c.useState)(0),D=(0,s.Z)(T,2),B=D[0],z=D[1],A=(0,c.useState)([]),M=(0,s.Z)(A,2),O=M[0],F=M[1],V=(0,c.useState)(1),X=(0,s.Z)(V,2),U=X[0],W=X[1],H=(0,c.useState)(!1),J=(0,s.Z)(H,2),Y=J[0],q=J[1];(0,c.useEffect)((function(){var e=function(){var e=(0,r.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C){e.next=7;break}return e.next=3,j.Q.zettel.get({lemma_id:C},{count:!0});case 3:t=e.sent,E(t[0].count),e.next=8;break;case 7:E(0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[C]);var $,ee=[["lemma","Wort"],["type","Typ"],["id","ID"],["ac_web","Werk"],["date_type","Datum-Typ"],["date_own","eigenes Sortierdatum"],["date_own_display","eigenes Anzeigedatum"]],te=function(e){F(O.filter((function(t){return t.id!==e})))},ne=function(){var e=(0,r.Z)(a().mark((function e(){var t,n,r,s,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,x.Z)(O);try{for(n.s();!(r=n.n()).done;)""!==(s=r.value).v&&t.push({c:s.c,o:s.o,v:s.v})}catch(a){n.e(a)}finally{n.f()}if(!(t.length>0)){e.next=11;break}return w(t),e.next=7,j.Q.zettel.search(t,{count:!0});case 7:i=e.sent,z(i[0].count),e.next=12;break;case 11:z(0);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=[],ie=(0,x.Z)(O);try{for(ie.s();!($=ie.n()).done;){var ae=$.value;re.push((0,k.jsx)(Z.Mj,{searchOptions:ee,removeSearchFields:function(e){te(e)},itemId:ae.id,c:ae.c,o:ae.o,v:ae.v,clickButton:ne,changeItem:function(e){F(O.map((function(t){return t.id===e.id?e:t})))}},ae.id))}}catch(ce){ie.e(ce)}finally{ie.f()}return(0,k.jsxs)(K.Z,{show:e.show,size:"lg",onHide:function(){e.onReplay(!1)},backdrop:"static",children:[(0,k.jsx)(K.Z.Header,{closeButton:!0,children:(0,k.jsx)(K.Z.Title,{children:"Zettel importieren"})}),(0,k.jsx)(K.Z.Body,{children:(0,k.jsx)(f.Z,{children:(0,k.jsxs)(P.Z,{defaultActiveKey:"0",children:[(0,k.jsxs)(P.Z.Item,{eventKey:"0",onClick:function(){u("lemma")},children:[(0,k.jsx)(P.Z.Header,{children:"Wort-Liste"}),(0,k.jsxs)(P.Z.Body,{children:[(0,k.jsx)(Z.Qc,{style:{width:"100%"},onChange:function(e,t){S(t),g(e)},value:h,tbl:"lemma",searchCol:"lemma",returnCol:"lemma_ac"}),Q>0?(0,k.jsxs)(G,{pill:!0,bg:"success",className:"mt-2",children:[Q," Zettel gefunden."]}):null]})]}),(0,k.jsxs)(P.Z.Item,{eventKey:"1",onClick:function(){u("zettel")},children:[(0,k.jsx)(P.Z.Header,{children:"Zettel-Datenbank"}),(0,k.jsxs)(P.Z.Body,{children:[(0,k.jsxs)("div",{className:"searchBox d-flex flex-wrap",children:[re,(0,k.jsx)(o.G,{color:"LightGray",icon:l.KtF,style:{color:"var(--mainColor)",position:"relative",top:"6px",fontSize:"25px",cursor:"pointer"},onClick:function(){!function(){var e=O;e.push({id:U,c:ee[0][0],o:"=",v:""}),W(U+1),F(e)}()}})]}),(0,k.jsxs)("div",{style:{textAlign:"right"},children:[B>0?(0,k.jsxs)(G,{pill:!0,bg:"success",className:"mt-2",style:{marginRight:"15px"},children:[B," Zettel gefunden."]}):null,(0,k.jsx)(R.Z,{variant:"light",onClick:function(){ne()},children:"Suchen"})]})]})]})]})})}),(0,k.jsxs)(K.Z.Footer,{children:[(0,k.jsx)(L.Z.Check,{style:{position:"absolute",left:"30px"},type:"switch",id:"custom-switch",label:"Zettel-Text importieren (experimentell)",onChange:function(e){q(e.target.checked)}}),(0,k.jsx)(R.Z,{variant:"secondary",onClick:function(){e.onReplay(!1)},children:"Abbrechen"}),(0,k.jsx)(Z.YG,{variant:"primary",onClick:function(){var t=(0,r.Z)(a().mark((function t(n){var r,s,c,o,l,u,d,f,p,g,m,v,Z,k;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=["id","ac_web","img_path","date_sort","txt","type","work_id","ocr_text_corr","ocr_text"],s=[],n(0),"lemma"!==i){t.next=20;break}return t.next=6,j.Q.zettel.get({lemma_id:C},{select:r});case 6:return s=t.sent,t.next=9,j.Q.article.get({project_id:e.project.id,type:900});case 9:if(c=t.sent,console.log(c),0!==c.length){t.next=18;break}return t.next=14,j.Q.article.save({name:h.replace(/<.*?>/g,""),project_id:e.project.id,type:900});case 14:return t.next=16,j.Q.article.get({project_id:e.project.id});case 16:o=t.sent,e.updateArticles(o);case 18:t.next=23;break;case 20:return t.next=22,j.Q.zettel.search(y,{select:r});case 22:s=t.sent;case 23:return l={},t.next=26,j.Q.tags.get({project_id:e.project.id});case 26:t.sent.forEach((function(e){l[e.name]=e.id})),u=[],d=[],n(25),f=(0,x.Z)(s),t.prev=32,f.s();case 34:if((p=f.n()).done){t.next=51;break}return g=p.value,t.next=38,j.Q.comment.get({zettel_id:g.id},{select:["comment","user"]});case 38:if(m=t.sent,u.push({zettel_id:g.id,project_id:e.project.id,ref:g.ac_web,text:g.txt?g.txt:g.ocr_text_corr&&Y?g.ocr_text_corr:g.ocr_text&&Y?g.ocr_text:null,comment:m.length>0?m.map((function(e){return"".concat(e.user,":\n").concat(e.comment,"\n")})).join("\n\n"):null,date_sort:0===g.date_sort?9999:g.date_sort,img:g.img_path,user_id:e.project.user_id,shared_id:e.project.shared_id,work_id:g.work_id}),v="unbekannter Zetteltyp",1===g.type?v="verzettelt":2===g.type?v="Exzerpt":3===g.type?v="Index":4===g.type?v="Literatur":6===g.type?v="Index (unkl. Werk)":7===g.type&&(v="Notiz"),!v){t.next=49;break}if(Object.keys(l).includes(v)){t.next=48;break}return t.next=46,j.Q.tags.save({name:v,color:se(),project_id:e.project.id,user_id:e.project.user_id,shared_id:e.project.shared_id,display:0});case 46:Z=t.sent,l[v]=Z;case 48:d.push({tag_id:l[v],user_id:e.project.user_id,shared_id:e.project.shared_id,project_id:e.project.id});case 49:t.next=34;break;case 51:t.next=56;break;case 53:t.prev=53,t.t0=t.catch(32),f.e(t.t0);case 56:return t.prev=56,f.f(),t.finish(56);case 59:return n(50),t.next=62,j.Q.sections.save(u);case 62:return k=t.sent,d=d.map((function(e,t){return e.section_id=k[t],e})),n(75),t.next=67,j.Q.tag_lnks.save(d);case 67:n(100),e.onReplay(!0);case 69:case"end":return t.stop()}}),t,null,[[32,53,56,59]])})));return function(e){return t.apply(this,arguments)}}(),disabled:!("lemma"===i&&Q>0||"zettel"===i&&B>0),value:"Zettel laden"})]})]})}function se(){var e=["#023FA5","#7D87A5","#BEC1D4","#D6BCC0","#BB7784","#8E063B","#4A6FE3","#8595E1","#B5BBE3","#E6AFB9","#E07B91","#D33F6A","#11C638","#8DD593","#C6DEC7","#EAD3C6","#F0B98D","#EF9708","#0FCFC0","#9CDED6","#D5EAE7","#F3E1EB","#F6C4E1","#F79CD4"];return e[Math.floor(Math.random()*e.length)]}var ie=n(9410),ae=n(2007),ce=n.n(ae),oe=n(5107),le=n(70),ue=ce().oneOf(["start","end"]),de=ce().oneOfType([ue,ce().shape({sm:ue}),ce().shape({md:ue}),ce().shape({lg:ue}),ce().shape({xl:ue}),ce().shape({xxl:ue}),ce().object]),fe=["title","children","bsPrefix","rootCloseEvent","variant","size","menuRole","renderMenuOnMount","disabled","href","id","menuVariant"],pe={id:ce().string,href:ce().string,onClick:ce().func,title:ce().node.isRequired,disabled:ce().bool,align:de,menuRole:ce().string,renderMenuOnMount:ce().bool,rootCloseEvent:ce().string,menuVariant:ce().oneOf(["dark"]),bsPrefix:ce().string,variant:ce().string,size:ce().string},xe=c.forwardRef((function(e,t){var n=e.title,r=e.children,s=e.bsPrefix,i=e.rootCloseEvent,a=e.variant,c=e.size,o=e.menuRole,l=e.renderMenuOnMount,u=e.disabled,d=e.href,f=e.id,p=e.menuVariant,x=(0,N.Z)(e,fe);return(0,k.jsxs)(v.Z,(0,_.Z)((0,_.Z)({ref:t},x),{},{children:[(0,k.jsx)(oe.Z,{id:f,href:d,size:c,variant:a,disabled:u,childBsPrefix:s,children:n}),(0,k.jsx)(le.Z,{role:o,renderOnMount:l,rootCloseEvent:i,variant:p,children:r})]}))}));xe.displayName="DropdownButton",xe.propTypes=pe;var he=xe,ge=n(4292),me=n(2469),ve=n(4849),je=[[900,"LEMMA"],[901,"VEL"],[902,"GRAMMATIK"],[903,"ETYMOLOGIE"],[904,"SCHREIBWEISE"],[905,"FORM"],[906,"STRUKTUR"],[907,"GEBRAUCH"],[908,"METRIK"],[909,"VERWECHSELBAR"]];function Ze(e){var t=(0,c.useState)(!0),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(!0),p=(0,s.Z)(d,2),x=p[0],h=p[1],g=(0,c.useState)(null),m=(0,s.Z)(g,2),Z=m[0],y=m[1],w=(0,c.useState)([]),b=(0,s.Z)(w,2),_=b[0],C=b[1],N=(0,c.useState)(""),Q=(0,s.Z)(N,2),E=Q[0],T=Q[1],D=(0,c.useState)(null),B=(0,s.Z)(D,2),z=B[0],A=B[1],M={borderTop:"4px dotted transparent",margin:"0 20px",height:"10px"};(0,c.useEffect)((function(){var t=e.articles.map((function(e){return e.type}));C(je.filter((function(e){return!t.includes(e[0])})))}),[e.articles]),(0,c.useEffect)((function(){_.length>0&&(T(_[0][1]),A(_[0][0]))}),[_]);var L=e.articlesLst.map((function(e){return parseInt(e.split("-")[0])})).sort()[e.articlesLst.length-1];return(0,k.jsxs)(f.Z,{className:"outlineBox",fluid:!0,children:[(0,k.jsxs)(S.Z,{className:"mb-3",children:[(0,k.jsx)(I.Z,{}),(0,k.jsxs)(I.Z,{xs:"8",style:{userSelect:"none",textAlign:"right",cursor:"pointer",color:"var(--bs-gray-500)"},onClick:function(){u(!i)},children:[i?null:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.G,{icon:l.gc2})," "]}),"Artikelkopf"]}),(0,k.jsx)(I.Z,{})]}),i?(0,k.jsxs)(k.Fragment,{children:[e.articles.filter((function(e){return e.type>=900})).sort((function(e,t){return e.type>t.type})).map((function(t){return(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{xs:"8",children:(0,k.jsxs)("div",{style:{display:"flex",marginBottom:"20px"},children:[(0,k.jsx)("div",{style:{width:"200px",fontWeight:"bold"},children:je.find((function(e){return e[0]===t.type}))[1]}),(0,k.jsx)("input",{value:t.name,onChange:function(n){e.changeArticle({id:t.id,name:n.target.value})},onBlur:function(){var e=(0,r.Z)(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.article.save({id:t.id,name:n.target.value});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),style:{width:"100%",outline:"none",border:"none",borderBottom:"1px solid var(--bs-gray-500)"},type:"text"})]})}),(0,k.jsx)(I.Z,{})]},t.id)})),_.length>0?(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{xs:"8",children:(0,k.jsxs)(ie.Z,{className:"mb-3",children:[(0,k.jsx)(he,{style:{width:"165px"},variant:"outline-secondary",title:E,id:"input-group-dropdown-1",children:_.map((function(e){return(0,k.jsx)(v.Z.Item,{onClick:function(){T(e[1]),A(e[0])},value:e[0],children:e[1]},e[0])}))}),(0,k.jsx)(ge.Z,{onKeyUp:function(t){13===t.keyCode&&(e.createNewArticle({type:z,name:t.target.value,sort_nr:-1}),C(_.filter((function(e){return e[0]!==z}))),t.target.value="")}})]})}),(0,k.jsx)(I.Z,{})]}):null]}):null,(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{xs:"8",style:{paddingBottom:"15px",marginBottom:"15px",borderBottom:"1px solid var(--bs-gray-500)"}}),(0,k.jsx)(I.Z,{})]}),(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsxs)(I.Z,{xs:"8",style:{userSelect:"none",textAlign:"right",cursor:"pointer",color:"var(--bs-gray-500)"},onClick:function(){h(!x)},children:[x?null:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.G,{icon:l.gc2})," "]}),"Stellen"]}),(0,k.jsx)(I.Z,{})]}),x?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{xs:"8",children:e.articlesLst.map((function(t){var n=t.split("-");return function(t,n){return(0,k.jsxs)("div",{style:{marginLeft:"".concat(25*n,"px")},children:[(0,k.jsx)("div",{style:M,onDrop:function(n){e.dropArticle(Z,t.parent_id,t.sort_nr),n.target.style.borderColor="transparent"},onDragOver:function(e){e.preventDefault(),e.target.style.borderColor="var(--bs-primary)"},onDragLeave:function(e){e.target.style.borderColor="transparent"}}),(0,k.jsx)(ke,{maxDepth:L,depth:n,deleteArticle:e.deleteArticle,changeArticle:e.changeArticle,project:e.project,articles:e.articles,a:t,dragObjectId:Z,setDragObjectId:function(e){y(e)},dropArticle:function(t,n,r){e.dropArticle(t,n,r)},collapsed:e.collapsedArticlesLst.includes(t.id),toggleCollapse:function(t){e.toggleCollapse(t)}})]},t.id)}(e.articles.find((function(e){return e.id===parseInt(n[1])})),n[0])}))}),(0,k.jsx)(I.Z,{})]}),0===e.articles.filter((function(e){return e.type<900})).length&&(0,k.jsxs)(S.Z,{className:"mt-4",children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{children:(0,k.jsxs)(me.Z,{tabIndex:"0",variant:"secondary",style:{padding:"8px 16px",fontSize:"90%",textAlign:"center",cursor:"pointer"},onKeyDown:function(t){13===t.keyCode&&e.createNewArticle()},onClick:function(){e.createNewArticle()},children:["Eine neue Bedeutung hinzuf\xfcgen ",(0,k.jsxs)("small",{children:["(",j.Q.options.action_key.toUpperCase(),"+N)"]})]})}),(0,k.jsx)(I.Z,{})]})]}):null]})}function ke(e){var t=(0,c.useState)(!1),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(0),f=(0,s.Z)(d,2),p=f[0],x=f[1];(0,c.useEffect)((function(){var t=function(){var t=(0,r.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({article_id:e.a.id},{count:!0});case 2:n=t.sent,x(n[0].count);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[]);var h=function(e){var t=e.target.closest(".articleBox").getElementsByClassName("articleBoxName")[0];t.contentEditable=!0,t.focus()},g=e.maxDepth<3?parseInt(e.depth)+2:e.depth<5?e.depth:4,m=_e[g][e.a.sort_nr-1];return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"articleBox",id:"articleBox_".concat(e.a.id),draggable:!0,onDragStart:function(){e.setDragObjectId(e.a.id)},onDrop:function(t){e.dragObjectId!==e.a.id&&e.dropArticle(e.dragObjectId,e.a.id,1),t.target.style.borderColor="transparent"},onDragOver:function(t){t.preventDefault(),e.dragObjectId!==e.a.id&&(t.target.style.borderColor="var(--bs-primary)")},onDragLeave:function(e){e.target.style.borderColor="transparent"},tabIndex:"0",onClick:function(e){e.target.focus()},onDoubleClick:function(e){h(e)},onKeyDown:function(t){if("articleBox"===t.target.className)if(9!==t.keyCode&&t.preventDefault(),8===t.keyCode||46===t.keyCode)e.deleteArticle(e.a.id);else if(13===t.keyCode)h(t);else if(37===t.keyCode&&t.shiftKey){if(e.a.parent_id>0){var n=e.articles.find((function(t){return t.id===e.a.parent_id}));e.dropArticle(e.a.id,n.parent_id,n.sort_nr+1)}}else if(37===t.keyCode&&!1===t.shiftKey){e.articles.filter((function(t){return t.parent_id===e.a.id})).length>0&&e.toggleCollapse(e.a.id)}else if(38===t.keyCode&&t.shiftKey){var r=e.articles.filter((function(t){return t.parent_id===e.a.parent_id&&t.sort_nr<e.a.sort_nr})).sort((function(e,t){return e.sort_nr>t.sort_nr}));r.length>0&&e.dropArticle(e.a.id,e.a.parent_id,r[r.length-1].sort_nr)}else if(38===t.keyCode&&!1===t.shiftKey){for(var s=document.getElementsByClassName("articleBox"),a=0;a<s.length;a++)if(s[a].id===t.target.id){0===a?s[s.length-1].focus():s[a-1].focus();break}}else if(39===t.keyCode&&t.shiftKey){var c=e.articles.filter((function(t){return t.parent_id===e.a.parent_id&&t.sort_nr<e.a.sort_nr})).sort((function(e,t){return e.sort_nr>t.sort_nr}));if(c.length>0){var o=e.articles.filter((function(e){return e.parent_id===c[c.length-1].id})).sort((function(e,t){return e.sort_nr>t.sort_nr}));o.length>0?e.dropArticle(e.a.id,c[c.length-1].id,o[o.length-1].sort_nr+1):e.dropArticle(e.a.id,c[c.length-1].id,1)}}else if(39===t.keyCode&&!1===t.shiftKey)u(!i);else if(40===t.keyCode&&t.shiftKey){e.articles.find((function(t){return t.parent_id===e.a.parent_id&&t.sort_nr>e.a.sort_nr}))&&e.dropArticle(e.a.id,e.a.parent_id,e.a.sort_nr+1)}else if(40===t.keyCode&&!1===t.shiftKey)for(var l=document.getElementsByClassName("articleBox"),d=0;d<l.length;d++)if(l[d].id===t.target.id){d===l.length-1?l[0].focus():l[d+1].focus();break}},children:[m,". ",(0,k.jsx)("span",{className:"articleBoxName",onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.target.contentEditable=!1,n.target.parentElement.focus(),-1===(r=n.target.innerText).search(/:$/)&&(r+=":"),t.next=6,j.Q.article.save({id:e.a.id,name:r});case 6:e.changeArticle({id:e.a.id,name:r});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onKeyDown:function(e){13===e.keyCode?(e.preventDefault(),e.target.blur()):39===e.keyCode&&window.getSelection().focusOffset+1===e.target.textContent.length&&e.preventDefault()},children:e.a.name})," ",p>0?(0,k.jsx)("small",{className:"text-primary",style:{marginLeft:"20px"},children:p}):null,e.collapsed?(0,k.jsx)("span",{className:"text-primary",style:{marginLeft:"15px"},children:"..."}):null,(0,k.jsxs)(v.Z,{style:{float:"right"},className:"EditArticleDropdown",children:[(0,k.jsx)(v.Z.Toggle,{size:"sm",tabIndex:"-1",variant:"outline-secondary",children:(0,k.jsx)(o.G,{icon:l.gr5})}),(0,k.jsxs)(v.Z.Menu,{children:[(0,k.jsx)(v.Z.Item,{onClick:function(e){setTimeout((function(){h(e)}),200)},children:"bearbeiten"}),(0,k.jsx)(v.Z.Item,{onClick:function(){u(!i)},children:i?"einklappen":"ausklappen"}),(0,k.jsx)(v.Z.Divider,{}),(0,k.jsx)(v.Z.Item,{onClick:function(){e.deleteArticle(e.a.id)},className:"text-danger",children:"Bedeutung l\xf6schen"})]})]})]}),i?(0,k.jsx)(ye,{articles:e.articles,setSectionCount:x,setSectionDetailId:function(t){e.setSectionDetailId(t)},inputMode:1,project:e.project,articleId:e.a.id}):null]})}function ye(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(0),f=(0,s.Z)(d,2),p=f[0],h=f[1],g=(0,c.useState)(""),m=(0,s.Z)(g,2),v=m[0],y=m[1],w=(0,c.useState)([]),b=(0,s.Z)(w,2),_=b[0],C=b[1],S=(0,c.useState)(0),I=(0,s.Z)(S,2),N=I[0],Q=I[1],E=(0,c.useState)(0),T=(0,s.Z)(E,2),D=T[0],B=T[1],z=(0,c.useState)([]),A=(0,s.Z)(z,2),M=A[0],L=A[1],R=(0,c.useState)(!1),O=(0,s.Z)(R,2),F=O[0],K=O[1],P=(0,c.useState)(!1),V=(0,s.Z)(P,2),X=V[0],G=V[1];(0,c.useEffect)((function(){H()}),[]),(0,c.useEffect)((function(){U()}),[v,p,F,M]);var U=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!F){t.next=31;break}if(!(p<3)){t.next=18;break}return t.next=4,j.Q.sections.get({project_id:e.project.id});case 4:return n=(n=(n=t.sent).filter((function(t){return(0===p&&!(t.article_id>0)||1===p&&t.article_id===e.articleId||2===p)&&null!==t.ref&&t.ref.toLowerCase().indexOf(v.toLowerCase())>-1}))).map((function(t){return{id:t.id,type:"section",name:"".concat(t.ref,"; ").concat(null!==t.text?t.text.substring(0,10):"","..."),articleName:2===p&&t.article_id!==e.articleId?e.articles.find((function(t){return t.id===e.articleId})).name:null}})),r=M.map((function(e){return e.id})),t.next=10,j.Q.tags.get({project_id:e.project.id,display:1});case 10:s=(s=(s=t.sent).filter((function(e){return(0===p&&-1===r.indexOf(e.id)||1===p&&r.indexOf(e.id)>-1||2===p)&&e.name.toLowerCase().indexOf(v.toLowerCase())>-1}))).map((function(e){return{id:e.id,type:"tag",name:e.name}})),(n=n.concat(s)).sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()})),C(n),t.next=31;break;case 18:if(!(v.length>3)){t.next=30;break}return G(!0),C([]),t.next=23,j.Q.scan_lnk.search([{c:"full_text",o:"LIKE",v:"%".concat(v,"%")}],{limit:"10",select:["id","edition_id","full_text","ac_web"]});case 23:i=t.sent,c=[],i.forEach((function(e){var t,n=0,r=(0,x.Z)(e.full_text.matchAll(new RegExp(v,"g")));try{for(r.s();!(t=r.n()).done;){var s=t.value;c.push({id:"".concat(e.id,"-").concat(n),edition_id:e.edition_id,type:"full_text",ac_web:e.ac_web,name:"...".concat(e.full_text.substring(s.index-100,s.index+s.length+100),"...")}),n++}}catch(i){r.e(i)}finally{r.f()}})),C(c),G(!1),t.next=31;break;case 30:C([]);case 31:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),W=function(){var t=(0,r.Z)(a().mark((function t(n){var r,s,i,c,o,l,u,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("tag"!==n.type){t.next=16;break}if(0!==p&&(2!==p||-1!==M.map((function(e){return e.id})).indexOf(n.id))){t.next=11;break}return t.next=4,j.Q.tag_lnks.save({tag_id:n.id,article_id:e.articleId});case 4:return t.next=6,j.Q.tag_lnks.search([{c:"tag_id",o:"=",v:n.id},{c:"section_id",o:">",v:0}],{select:["section_id"]});case 6:return r=t.sent,t.next=9,j.Q.sections.save(r.map((function(t){return{id:t.section_id,article_id:e.articleId}})));case 9:t.next=14;break;case 11:if(1!==p){t.next=14;break}return t.next=14,J(e.articleId,n.id);case 14:t.next=58;break;case 16:if("full_text"!==n.type){t.next=28;break}return t.next=19,j.Q.edition.get({id:n.edition_id},{select:["work_id"]});case 19:return s=t.sent,t.next=22,j.Q.work.get({id:s[0].work_id},{select:["date_sort"]});case 22:return i=t.sent,t.next=25,j.Q.sections.save({project_id:e.project.id,ref:n.ac_web,text:n.name,date_sort:i[0].date_sort,user_id:e.project.user_id,shared_id:e.project.shared_id,work_id:s[0].work_id,article_id:e.articleId});case 25:C([]),t.next=58;break;case 28:if(c=!0,2!==p||null===n.articleName){t.next=55;break}return t.next=32,j.Q.tag_lnks.get({section_id:n.id},{select:["tag_id"]});case 32:o=t.sent,l=(0,x.Z)(o),t.prev=34,l.s();case 36:if((u=l.n()).done){t.next=47;break}return d=u.value,t.next=40,j.Q.tag_lnks.search([{c:"tag_id",o:"=",v:d.tag_id},{c:"article_id",o:">",v:0}]);case 40:if(!(t.sent.length>0)){t.next=45;break}return alert("Achtung: Die Stelle wurde durch ein Schlagwort automatisch zugewiesen. Entfernen Sie es von der Stelle, um sie dieser Bedeutung zuweisen zu k\xf6nnen."),c=!1,t.abrupt("break",47);case 45:t.next=36;break;case 47:t.next=52;break;case 49:t.prev=49,t.t0=t.catch(34),l.e(t.t0);case 52:return t.prev=52,l.f(),t.finish(52);case 55:if(!c){t.next=58;break}return t.next=58,j.Q.sections.save({id:n.id,article_id:1===p?null:e.articleId});case 58:return t.next=60,H();case 60:return t.next=62,U();case 62:case"end":return t.stop()}}),t,null,[[34,49,52,55]])})));return function(e){return t.apply(this,arguments)}}(),H=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({article_id:e.articleId},{order:["date_sort"]});case 2:return n=t.sent,u(n),e.setSectionCount(n.length),t.next=7,j.Q.tag_lnks.get({article_id:e.articleId},{select:["tag_id"]});case 7:r=t.sent,s=[],i=(0,x.Z)(r),t.prev=10,i.s();case 12:if((c=i.n()).done){t.next=20;break}return o=c.value,t.next=16,j.Q.tags.get({id:o.tag_id});case 16:l=t.sent,s.push(l[0]);case 18:t.next=12;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(10),i.e(t.t0);case 25:return t.prev=25,i.f(),t.finish(25);case 28:L(s.sort((function(e,t){return e.name>t.name})));case 29:case"end":return t.stop()}}),t,null,[[10,22,25,28]])})));return function(){return t.apply(this,arguments)}}(),J=function(){var e=(0,r.Z)(a().mark((function e(t,n){var r,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.Q.tag_lnks.get({tag_id:n,article_id:t},{select:["id"]});case 2:return r=e.sent,e.next=5,j.Q.tag_lnks.delete(r[0].id);case 5:return e.next=7,j.Q.tag_lnks.search([{c:"tag_id",o:"=",v:n},{c:"section_id",o:">",v:0}],{select:["section_id"]});case 7:return s=e.sent,e.next=10,j.Q.sections.save(s.map((function(e){return{id:e.section_id,article_id:null}})));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Y="0.5px solid #ced4da",q="white";return 1===p?(Y="1px solid var(--bs-yellow)",q="#ffecb1"):2===p?(Y="1px solid var(--bs-teal)",q="#e2f7ed"):3===p&&(Y="1px solid #074297",q="#e6f0fe"),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(be,{project:e.project,handleClose:function(){H(),B(0)},sectionDetailId:D}),(0,k.jsxs)("div",{className:"ArticleBoxSections",children:[(0,k.jsx)("div",{className:"outlineSectionTagBox",children:M.map((function(t){return(0,k.jsxs)("div",{className:"outlineSectionTags",style:{backgroundColor:t.color,padding:"0 7px 2px 7px"},children:[(0,k.jsx)("span",{style:{position:"relative",top:"-1px"},children:t.name}),(0,k.jsx)(o.G,{onClick:function(){var n=(0,r.Z)(a().mark((function n(r){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.stopPropagation(),n.next=3,J(e.articleId,t.id);case 3:return n.next=5,H();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),className:"removeTagButton",icon:l.g82})]},t.id)}))}),(0,k.jsx)("div",{children:i.map((function(e){return(0,k.jsx)(we,{s:e,setSectionDetailId:B,loadSections:H,articleTagLst:M},e.id)}))}),(0,k.jsxs)("div",{style:{width:"100%",position:"relative",display:"inline-block"},children:[(0,k.jsx)("input",{className:"tagBoxOutlineSection",value:v,onChange:function(e){y(e.target.value)},onFocus:function(){K(!0)},onBlur:function(){K(!1),y(""),C([])},type:"text",onKeyDown:function(e){!function(e){9===e.keyCode&&1===_.length?e.preventDefault():27===e.keyCode?(y(""),C([])):190===e.keyCode&&""===e.target.value?(e.preventDefault(),h(2!==p?2:0)):173===e.keyCode&&""===e.target.value?(e.preventDefault(),h(1!==p?1:0)):60===e.keyCode&&!1===e.shiftKey&&""===e.target.value?(e.preventDefault(),h(3!==p?3:0)):40===e.keyCode?(e.preventDefault(),_.length>0?N+1>=_.length?Q(0):Q(N+1):e.target.parentNode.parentNode.firstChild.firstChild.focus()):38===e.keyCode?(e.preventDefault(),_.length>0?Q(N-1<0?_.length-1:N-1):e.target.parentNode.parentNode.firstChild.lastChild.focus()):13===e.keyCode&&(e.preventDefault(),W(_[N]))}(e)}}),X?(0,k.jsx)(ve.Z,{style:{position:"absolute",top:"12px",right:"4px"},variant:"primary",animation:"border",size:"sm"}):null,_.length>0&&(0,k.jsx)("div",{className:"autocomplete-items",style:{border:Y},children:_.map((function(e,t){return(0,k.jsxs)("div",{style:{fontWeight:"tag"===e.type?"bold":null,fontStyle:"tag"===e.type?"italic":null,backgroundColor:q,border:Y},onMouseDown:(0,r.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W(e);case 2:case"end":return t.stop()}}),t)}))),className:t===N?"autocomplete-active":"",children:[e.ac_web?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("b",{children:e.ac_web}),":"]}):null,(0,k.jsx)("p",{style:{marginLeft:e.ac_web?"15px":null},dangerouslySetInnerHTML:(0,Z.rg)(e.name.replace(new RegExp("(".concat(v,")"),"gi"),"<u>$1</u>"))}),e.articleName?(0,k.jsx)("small",{children:e.articleName}):null]},e.id)}))})]})]})]})}function we(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],u=n[1];(0,c.useEffect)((function(){var t=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.tag_lnks.get({section_id:e.s.id},{select:["tag_id"]});case 2:n=t.sent,r=[],s=(0,x.Z)(n),t.prev=5,s.s();case 7:if((i=s.n()).done){t.next=15;break}return c=i.value,t.next=11,j.Q.tags.get({id:c.tag_id,display:1});case 11:(o=t.sent).length>0&&r.push(o[0]);case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),s.e(t.t0);case 20:return t.prev=20,s.f(),t.finish(20);case 23:r.sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()})),u(r);case 25:case"end":return t.stop()}}),t,null,[[5,17,20,23]])})));return function(){return t.apply(this,arguments)}}();t()}),[]);var d=function(){var t=(0,r.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.map((function(e){return e.name})),!(e.articleTagLst.filter((function(e){return n.includes(e.name)})).length>0)){t.next=5;break}alert("Diese Stelle kann nicht einzeln entfernt werden. Entfernen Sie das Schlagwort, um die Stelle zu entfernen."),t.next=9;break;case 5:if(!window.confirm("Soll die Stelle von der Bedeutung entfernt werden?")){t.next=9;break}return t.next=8,j.Q.sections.save({id:e.s.id,article_id:null});case 8:e.loadSections();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,k.jsxs)("div",{className:"sectionBox",tabIndex:"0",onClick:function(e){e.target.closest(".sectionBox").focus()},onKeyDown:function(t){8===t.keyCode||46===t.keyCode?d():38===t.keyCode?(t.preventDefault(),t.target.previousSibling?t.target.previousSibling.focus():t.target.parentNode.parentNode.lastChild.lastChild.focus()):40===t.keyCode?(t.preventDefault(),t.target.nextSibling?t.target.nextSibling.focus():t.target.parentNode.parentNode.lastChild.lastChild.focus()):13===t.keyCode&&(t.preventDefault(),e.setSectionDetailId(e.s.id))},children:[(0,k.jsx)("span",{className:"sectionBoxTitle",children:e.s.ref})," ",e.s.text,(0,k.jsx)("div",{className:"outlineSectionTagBox",children:i.map((function(e){return(0,k.jsx)("div",{className:"outlineSectionTags",style:{backgroundColor:e.color},children:e.name},e.id)}))}),(0,k.jsxs)(v.Z,{style:{float:"right"},className:"EditSectionDropdown",children:[(0,k.jsx)(v.Z.Toggle,{size:"sm",tabIndex:"-1",variant:"outline-secondary",children:(0,k.jsx)(o.G,{icon:l.gr5})}),(0,k.jsxs)(v.Z.Menu,{children:[(0,k.jsx)(v.Z.Item,{onClick:function(t){e.setSectionDetailId(e.s.id)},children:"bearbeiten"}),(0,k.jsx)(v.Z.Divider,{}),(0,k.jsx)(v.Z.Item,{onClick:function(){d()},className:"text-danger",children:"Stelle aus Gliederung entfernen"})]})]})]},e.s.id)}function be(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],u=n[1],d=(0,c.useState)(!1),f=(0,s.Z)(d,2),p=f[0],h=f[1],g=(0,c.useState)(""),m=(0,s.Z)(g,2),v=m[0],Z=m[1],y=(0,c.useState)(null),w=(0,s.Z)(y,2),b=w[0],_=w[1],C=(0,c.useState)(""),N=(0,s.Z)(C,2),Q=N[0],E=N[1],T=(0,c.useState)(""),D=(0,s.Z)(T,2),B=D[0],z=D[1],A=(0,c.useState)(!1),M=(0,s.Z)(A,2),R=M[0],F=M[1],P=(0,c.useState)([]),V=(0,s.Z)(P,2),X=V[0],G=V[1],U=(0,c.useState)([]),W=(0,s.Z)(U,2),H=W[0],Y=W[1],q=(0,c.useState)({}),$=(0,s.Z)(q,2),te=$[0],ne=$[1];(0,c.useEffect)((function(){_(te.img+"".concat(R?"v":"",".jpg"))}),[R]),(0,c.useEffect)((function(){e.sectionDetailId>0&&(re(),document.getElementById("sectionDetailEditFirstInput")&&document.getElementById("sectionDetailEditFirstInput").focus())}),[e.sectionDetailId]);var re=function(){var t=(0,r.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({id:e.sectionDetailId});case 2:return n=t.sent,_(j.Q.url+n[0].img+"".concat(R?"v":"",".jpg")),E(n[0].ref),z(n[0].text),Z(n[0].comment),null!==n[0].comment&&""!==n[0].comment&&h(!0),ne(n[0]),t.t0=u,t.next=12,j.Q.edition.get({work_id:n[0].work_id},{select:["id","label","url"]});case 12:t.t1=t.sent,(0,t.t0)(t.t1);case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),se=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.tags.get({project_id:e.project.id});case 2:return n=t.sent,t.next=5,j.Q.tag_lnks.get({section_id:e.sectionDetailId});case 5:r=t.sent,s=[],i=(0,x.Z)(r);try{for(o=function(){var e=c.value,t=n.findIndex((function(t){return t.id===e.tag_id}));if(-1===t)throw"ERROR! CANNOT FIND TAG INDEX!";s.push(n[t]),n.splice(t,1)},i.s();!(c=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}Y(n),G(s);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,k.jsxs)(K.Z,{show:e.sectionDetailId>0,onHide:e.handleClose,size:"xl",children:[(0,k.jsx)(K.Z.Header,{closeButton:!0,children:(0,k.jsx)(K.Z.Title,{})}),(0,k.jsx)(K.Z.Body,{children:(0,k.jsxs)(O.Z,{className:"largeScreen",id:"s_"+e.sectionDetailId,style:{margin:"auto"},children:[(0,k.jsx)(O.Z.Img,{style:{aspectRatio:"10/7"},variant:"top",src:b}),(0,k.jsxs)(O.Z.Body,{children:[(0,k.jsx)("div",{style:{position:"absolute",top:"5px",left:"10px",right:"430px",opacity:"0.5"},children:(0,k.jsx)("a",{onClick:function(){F(!R)},title:"Zettel drehen",children:(0,k.jsx)(o.G,{icon:l.go9})})}),(0,k.jsxs)(S.Z,{className:"mb-2",children:[(0,k.jsx)(I.Z,{children:(0,k.jsx)(L.Z.Control,{id:"sectionDetailEditFirstInput",placeholder:"Zitiertitel...",size:"sm",type:"text",value:Q||"",onChange:function(e){E(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sectionDetailId,ref:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})}),(0,k.jsx)(I.Z,{style:{textAlign:"right"},xs:4,children:(0,k.jsx)(J,{setRessourceView:function(t){e.setRessourceView(t)},ressources:i})})]}),(0,k.jsx)(L.Z.Control,{placeholder:"Text der Stelle...",as:"textarea",rows:3,style:{fontSize:"95%"},value:B||"",onChange:function(e){z(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sectionDetailId,text:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),p?(0,k.jsx)("div",{children:(0,k.jsx)(L.Z.Control,{className:"mt-2",placeholder:"Schreiben Sie einen Kommentar...",as:"textarea",rows:3,style:{fontSize:"95%"},value:v||"",onChange:function(e){Z(e.target.value)},onBlur:function(){var t=(0,r.Z)(a().mark((function t(n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.save({id:e.sectionDetailId,comment:n.target.value});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})}):(0,k.jsx)("div",{style:{textAlign:"right"},children:(0,k.jsx)("a",{style:{fontSize:"90%"},className:"link-secondary",onClick:function(){h(!0)},children:"Kommentar hinzuf\xfcgen"})}),(0,k.jsx)(ee,{centerSection:function(){},loadTags:(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se();case 2:case"end":return e.stop()}}),e)}))),tags:X,project:e.project,s:te,unusedTags:H})]})]})})]})}var _e=[["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX","XXI","XXII","XXIII","XXIV","XXV","XXVI","XXVII","XXVIII","XXIX","XXX"],["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],["\u03b1","\u03b2","\u03b3","\u03b4","\u03b5","\u03b6","\u03b7","\u03b8","\u03b9","\u03ba","\u03bb","\u03bc","\u03bd","\u03be","\u03bf","\u03c0","\u03c1","\u03c3","\u03c4","\u03c5","\u03c6","\u03c7","\u03c8","\u03c9"]];function Ce(e){var t=(0,c.useState)(""),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(""),u=(0,s.Z)(l,2),d=u[0],p=u[1],x=(0,c.useState)(!0),m=(0,s.Z)(x,2),v=m[0],y=m[1],w=(0,c.useState)(!0),b=(0,s.Z)(w,2),_=b[0],C=b[1],N=(0,c.useState)(null),Q=(0,s.Z)(N,2),E=Q[0],T=Q[1],D=(0,c.useState)(0),B=(0,s.Z)(D,2),z=B[0],A=B[1];return(0,c.useEffect)((function(){var t=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,l,u,d,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.next=3,j.Q.article.get({project_id:e.project.id});case 3:return r=t.sent,t.next=6,j.Q.sections.get({project_id:e.project.id});case 6:if(s=t.sent,i=r.find((function(e){return 900===e.type})),p(void 0!==i?i.name:"export"),c=[],l=[],!_){t.next=18;break}return t.next=14,j.Q.tags.get({project_id:e.project.id});case 14:return c=t.sent,t.next=17,j.Q.tag_lnks.get({project_id:e.project.id});case 17:l=t.sent;case 18:return n=n.concat(r.filter((function(e){return e.type>=900})).map((function(e){return"".concat(je.find((function(t){return t[0]===e.type}))[1]," ").concat(e.name)}))),u=function e(t,i){0===i?n.push("BEDEUTUNG ".concat(t.name)):1===i?n.push("    UNTER_BEDEUTUNG ".concat(t.name)):2===i?n.push("        UNTER_UNTER_BEDEUTUNG ".concat(t.name)):n.push("".concat("    ".repeat(i)).concat("U".repeat(i),"_BEDEUTUNG ").concat(t.name)),s.filter((function(e){return e.article_id===t.id})).forEach((function(e){var t=[];_&&(t=l.filter((function(t){return t.section_id===e.id})).map((function(e){return c.find((function(t){return t.id===e.tag_id})).name}))),n.push("".concat("    ".repeat(i+1),"* ").concat(e.ref,' "').concat(e.text?e.text:"",'"').concat(t.length>0?" // "+t.join(", "):"")),v&&e.comment&&n.push("".concat("    ".repeat(i+2),"/*\n").concat("    ".repeat(i+3)).concat(e.comment.replace(new RegExp("\n","g"),"\n".concat("    ".repeat(i+3))),"\n").concat("    ".repeat(i+2),"*/"))})),r.filter((function(e){return e.parent_id===t.id})).forEach((function(t){e(t,i+1)}))},r.filter((function(e){return 0===e.parent_id&&e.type<900})).forEach((function(e){u(e,0)})),n.push("AUTORIN ".concat(j.Q.me.last_name)),o(n.join("\n")),A(1),d=n.join("\n"),t.next=27,j.Q.exec("mlw_preview",!0,d);case 27:f=t.sent,T(f.html),A(2);case 30:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[v,_]),(0,k.jsxs)(f.Z,{children:[(0,k.jsxs)(S.Z,{className:"mb-4",children:[(0,k.jsxs)(I.Z,{style:{padding:"0 10em 0 10em"},children:[(0,k.jsx)(L.Z.Check,{type:"switch",id:"custom-switch",label:"Kommentare in Export aufnehmen.",checked:v,value:v,onChange:function(e){y(!v)}}),(0,k.jsx)(L.Z.Check,{type:"switch",id:"custom-switch",label:"Tags in Export aufnehmen.",checked:_,value:_,onChange:function(e){C(!_)}})]}),(0,k.jsx)(I.Z,{children:(0,k.jsx)(R.Z,{onClick:function(){(0,Z.Sv)("".concat(d,".mlw"),i)},children:".mlw-Datei herunterladen"})})]}),(0,k.jsxs)(h.Z,{defaultActiveKey:"text",className:"mb-4",children:[(0,k.jsx)(g.Z,{eventKey:"text",title:"Exporttext",children:(0,k.jsxs)(S.Z,{children:[(0,k.jsx)(I.Z,{}),(0,k.jsx)(I.Z,{xs:11,children:(0,k.jsx)("textarea",{className:"exportTextBox",value:i,onChange:function(){}})}),(0,k.jsx)(I.Z,{})]})}),z>0&&(0,k.jsx)(g.Z,{eventKey:"preview",title:(0,k.jsxs)("span",{children:["Vorschau",1===z?(0,k.jsx)(ve.Z,{style:{marginLeft:"10px"},variant:"primary",animation:"border",size:"sm"}):null]}),children:(0,k.jsx)(S.Z,{children:(0,k.jsx)(I.Z,{children:(0,k.jsx)("div",{children:(0,k.jsx)("iframe",{style:{width:"100%",height:"500px"},srcDoc:E})})})})})]})]})}function Se(e){var t=(0,c.useState)("zettel"),n=(0,s.Z)(t,2),i=n[0],o=n[1],l=(0,c.useState)(null),u=(0,s.Z)(l,2),h=u[0],g=u[1],m=(0,c.useState)([]),v=(0,s.Z)(m,2),y=v[0],w=v[1],b=(0,c.useState)([]),I=(0,s.Z)(b,2),N=I[0],Q=I[1],E=(0,c.useState)([]),T=(0,s.Z)(E,2),D=T[0],B=T[1],z=(0,c.useState)([]),A=(0,s.Z)(z,2),M=A[0],L=A[1],R=(0,c.useState)([]),O=(0,s.Z)(R,2),F=O[0],K=O[1],P=(0,c.useState)([]),V=(0,s.Z)(P,2),X=V[0],G=V[1],W=(0,c.useState)([]),H=(0,s.Z)(W,2),J=H[0],Y=H[1],q=(0,c.useState)(!1),$=(0,s.Z)(q,2),ee=($[0],$[1]),te=(0,c.useState)(null),ne=(0,s.Z)(te,2),re=ne[0],se=ne[1],ie=(0,c.useState)(!1),ae=(0,s.Z)(ie,2),ce=ae[0],oe=ae[1],le=(0,c.useState)({}),ue=(0,s.Z)(le,2),de=ue[0],fe=ue[1],pe=[["ACTION+ESC",function(){e.loadMain(null,null)}],["ACTION+f",function(){"zettel"===i&&se("filter")}],["ACTION+t",function(){"zettel"===i&&se("tags")}],["ACTION+q",function(){"zettel"===i&&se("search")}],["ACTION+i",function(){"zettel"===i&&oe(!ce)}],["ACTION+r",function(){"zettel"===i&&(L([]),ve())}],["ACTION+1",function(){o("zettel")}],["ACTION+2",function(){o("outline")}],["ACTION+3",function(){o("export")}],["ACTION+n",function(){"zettel"===i?fe({value:"",id:0,section_id:0}):"outline"===i&&ge()}]];(0,Z.XU)(pe,!1),(0,c.useEffect)((function(){Y("zettel"===i?[["Zettel importieren <small>(".concat(j.Q.options.action_key.toUpperCase(),"+I)</small>"),function(){oe(!0)}],["Seitenleiste einblenden <small>(".concat(j.Q.options.action_key.toUpperCase(),"+Q/F/T)</small>"),function(){se("filter")}],["Filter neu laden <small>(".concat(j.Q.options.action_key.toUpperCase(),"+R)</small>"),function(){L([]),ve()}],["Neue Stelle erstellen <small>(".concat(j.Q.options.action_key.toUpperCase(),"+N)</small>"),function(){fe({value:"",id:0,section_id:0})}]]:"outline"===i?[["Neue Bedeutung hinzuf\xfcgen <small>(".concat(j.Q.options.action_key.toUpperCase(),"+N)</small>"),function(){ge()}]]:[])}),[i]);var xe=function(e){w(e);Q(function t(n,r){var s=e.filter((function(e){return e.parent_id===n&&e.type<900})).sort((function(e,t){return e.sort_nr>t.sort_nr})),i=[];return s.forEach((function(e){if(i.push("".concat(r,"-").concat(e.id)),!D.includes(e.id)){var n=t(e.id,r+1);n.length>0&&(i=i.concat(n))}})),i}(0,0))};(0,c.useEffect)((function(){xe(y)}),[D]),(0,c.useEffect)((function(){var t=function(){var t=(0,r.Z)(a().mark((function t(){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.project.get({id:e.resId});case 2:return n=t.sent,g(n[0]),t.next=6,j.Q.article.get({project_id:e.resId});case 6:r=t.sent,xe(r);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t(),ve()}),[]);var he=function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Soll die Bedeutung wirklich gel\xf6scht werden? Alle Unterbedeutungen werden ebenfalls gel\xf6scht.")){e.next=2;break}return e.delegateYield(a().mark((function e(){var n,r,s,i,c,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function e(t){var n=[t];return y.filter((function(e){return e.parent_id===t})).map((function(e){return e.id})).forEach((function(t){n=n.concat(e(t))})),n},r=n(t),s=[],i=(0,x.Z)(r),e.prev=4,i.s();case 6:if((c=i.n()).done){e.next=14;break}return o=c.value,e.next=10,j.Q.sections.get({article_id:o},{select:["id"]});case 10:e.sent.forEach((function(e){return s.push({id:e.id,article_id:null})}));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.next=24,j.Q.article.delete(r);case 24:return e.next=26,j.Q.sections.save(s);case 26:xe(y.filter((function(e){return!r.includes(e.id)})));case 27:case"end":return e.stop()}}),e,null,[[4,16,19,22]])}))(),"t0",2);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=(0,r.Z)(a().mark((function e(){var t,n,r,s,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},(n=t).type=n.type?n.type:0,n.project_id=h.id,n.parent_id=0,n.name=n.name?n.name:"Neue Bedeutung:",n.sort_nr=n.sort_nr?n.sort_nr:y.length>0?Math.max.apply(Math,(0,C.Z)(y.filter((function(e){return 0===e.parent_id})).map((function(e){return e.sort_nr}))))+1:1,e.next=9,j.Q.article.save(n);case 9:r=e.sent,n.id=r,(s=y.map((function(e){return e}))).push(n),xe(s);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=(0,r.Z)(a().mark((function e(t,n,r){var s,i,c,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=y,i=y.find((function(e){return e.id===t})),(c=y.filter((function(e){return e.parent_id===i.parent_id&&e.sort_nr>i.sort_nr})).map((function(e){return{id:e.id,sort_nr:e.sort_nr-1}}))).forEach((function(e){var t=s.findIndex((function(t){return t.id===e.id}));s[t].sort_nr=e.sort_nr})),(o=s.filter((function(e){return e.parent_id===n&&e.sort_nr>=r})).map((function(e){return{id:e.id,parent_id:n,sort_nr:e.sort_nr+1}}))).push({id:t,parent_id:n,sort_nr:r}),o.forEach((function(e){var t=s.findIndex((function(t){return t.id===e.id}));s[t].parent_id=n,s[t].sort_nr=e.sort_nr})),e.next=9,j.Q.article.save(o.concat(c.filter((function(e){return-1===o.findIndex((function(t){return e.id===t.id}))}))));case 9:xe(s);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ve=function(){var t=(0,r.Z)(a().mark((function t(){var n,r,s,i,c,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.Q.sections.get({project_id:e.resId},{select:["id"],order:["date_sort"]});case 2:if(n=t.sent,!(X.length>0)){t.next=7;break}L(X),t.next=21;break;case 7:if(0!==F.length){t.next=11;break}L(n.map((function(e){return e.id}))),t.next=21;break;case 11:return t.next=13,j.Q.tags.get({project_id:e.resId},{select:["id"]});case 13:return r=t.sent,t.next=16,j.Q.tag_lnks.get({tag_id:r.map((function(e){return e.id}))});case 16:s=t.sent,n=n.map((function(e){return e.tags=s.filter((function(t){return t.section_id===e.id})).map((function(e){return e.tag_id})),e})),i=(0,x.Z)(F);try{for(o=function(){var e=c.value;n=e.exclude?n.filter((function(t){return!t.tags.includes(e.id)})):n.filter((function(t){return t.tags.includes(e.id)}))},i.s();!(c=i.n()).done;)o()}catch(a){i.e(a)}finally{i.f()}L(n.map((function(e){return e.id})));case 21:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),je=null;switch(i){case"zettel":je=(0,k.jsx)(U,{filterSearchIds:X,setFilterSearchIds:G,updateArticles:xe,changeZettelWork:de,setChangeZettelWork:fe,setLimitFilterResults:function(e){ee(e)},showImport:ce,sectionsMenuActiveTabKey:re,filterTags:F,setFilterTags:function(e){K(e)},setSectionsMenuActiveTabKey:function(e){se(e)},setShowImport:function(e){oe(e)},project:h,filterLst:M,updateSections:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&L([]),ve()}});break;case"outline":je=(0,k.jsx)(Ze,{deleteArticle:he,createNewArticle:ge,changeArticle:function(e){xe(y.map((function(t){return t.id!==e.id?t:(0,_.Z)((0,_.Z)({},t),e)})))},project:h,dropArticle:function(e,t,n){me(e,t,n)},articlesLst:N,articles:y,collapsedArticlesLst:D,toggleCollapse:function(e){var t;t=e,D.includes(t)?B(D.filter((function(e){return e!==t}))):B(D.concat([t]))}});break;case"export":je=(0,k.jsx)(Ce,{project:h});break;default:je=(0,k.jsxs)("div",{children:["Modus '",i,"' nicht gefunden."]})}return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Z.v0,{show:Object.keys(de).length>0,title:"verknpft. Werk ausw\xe4hlen",msg:"Mit welchem Werk soll die Stelle verkn\xfcpft werden?",AutoComplete:{value:de.value,id:de.id,tbl:"work",searchCol:"ac_web",returnCol:"ac_web"},onReplay:function(){var e=(0,r.Z)(a().mark((function e(t){var n,r,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=23;break}if(n={work_id:t.id},!(de.section_id>0)){e.next=10;break}return n.id=de.section_id,e.next=6,j.Q.sections.get({id:de.section_id},{select:["ref"]});case 6:e.sent[0].ref!=t.value&&window.confirm("Soll auch der Zitiertitel ge\xe4ndert werden?")&&(n.ref=t.value+";"),e.next=18;break;case 10:return e.next=12,j.Q.work.get({id:t.id},{select:["date_sort"]});case 12:r=e.sent,n.ref=t.value+";",n.project_id=h.id,n.user_id=h.user_id,n.shared_id=h.shared_id,n.date_sort=r[0].date_sort;case 18:return e.next=20,j.Q.sections.save(n);case 20:s=e.sent,0===de.section_id&&(0,Z._v)(300).then((function(){var e=document.getElementById("s_".concat(s));e&&e.scrollIntoView({behavior:"auto",block:"center"})})),ve(!0);case 23:fe({});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,k.jsx)(d.Z,{bg:"dark",variant:"dark",fixed:"top",style:{top:"0px"},children:(0,k.jsxs)(f.Z,{fluid:!0,style:{height:"40px"},children:[(0,k.jsx)(d.Z.Brand,{style:{cursor:"pointer"},onClick:function(t){e.loadMain(t,null)},children:"Editor"}),(0,k.jsx)(d.Z.Toggle,{}),(0,k.jsxs)(d.Z.Collapse,{className:"justify-content-end",children:[(0,k.jsxs)(p.Z,{style:{fontSize:"110%"},children:[(0,k.jsx)(p.Z.Link,{className:"text-white",style:{textDecoration:"zettel"===i?"underline":null},onClick:function(){o("zettel")},children:"Stellen"}),(0,k.jsx)(d.Z.Text,{style:{width:"80px",borderBottom:"3px solid white",height:"25px"}}),(0,k.jsx)(p.Z.Link,{className:"text-white",style:{textDecoration:"outline"===i?"underline":null},onClick:function(){o("outline")},children:"Gliederung"}),(0,k.jsx)(d.Z.Text,{style:{width:"80px",borderBottom:"3px solid white",height:"25px"}}),(0,k.jsx)(p.Z.Link,{className:"text-white",style:{textDecoration:"export"===i?"underline":null},onClick:function(){o("export")},children:"Export"})]}),(0,k.jsx)(p.Z,{children:(0,k.jsx)(d.Z.Text,{children:(0,k.jsx)(Z.vW,{menuItems:J,direction:"down"})})})]})]})}),null!=h?(0,k.jsx)(f.Z,{style:{marginTop:"120px"},fluid:!0,children:je}):(0,k.jsx)(f.Z,{children:(0,k.jsx)(S.Z,{children:"Project wird geladen..."})})]})}var Ie=n(2583),Ne=n(8491);function Qe(){var e=JSON.parse(localStorage.getItem("editor_settings"));return null===e&&(e={}),e.hasOwnProperty("projectSort")||(e.projectSort="name"),e.hasOwnProperty("openExternal")||(e.openExternal=!1),e}function Ee(e){return Qe()[e]}function Te(e,t){var n=Qe();n[e]=t,localStorage.setItem("editor_settings",JSON.stringify(n))}function De(e){j.Q.changeLog=ze;var t=null;switch(e.res){case null:t=(0,k.jsx)(y,{loadMain:function(){e.loadMain.apply(e,arguments)}});break;case"editor":t=(0,k.jsx)(Se,{loadMain:function(){e.loadMain.apply(e,arguments)},resId:e.resId});break;case"changelog":t=(0,k.jsx)(Ie.v,{});break;case"settings":t=(0,k.jsx)(Ne.m,{});break;default:t=(0,k.jsxs)("div",{children:['Unbekannter Men\xfc-Punkt: "',e.res,'"']})}return(0,k.jsx)(k.Fragment,{children:t})}function Be(e){var t=(0,c.useState)([]),n=(0,s.Z)(t,2),i=n[0],x=n[1],h=(0,c.useState)("zuletzt ge\xf6ffnet"),g=(0,s.Z)(h,2),m=g[0];g[1];return(0,c.useEffect)((function(){var t=function(){var t=(0,r.Z)(a().mark((function t(){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=localStorage.getItem("openRecentEditor"))){t.next=9;break}return n=JSON.parse(n).reverse(),t.next=5,j.Q.project.getAll({select:["id","name"]});case 5:r=t.sent,n=n.filter((function(e){return void 0!==r.find((function(t){return t.id===e}))})),localStorage.setItem("openRecentEditor",n),x(n.map((function(t){var n=r.find((function(e){return e.id===t}));return(0,k.jsx)(u.Z.Item,{onClick:function(t){e.loadMain(t,"editor",n.id)},children:n.name},n.id)})));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[]),(0,k.jsx)(d.Z,{bg:"dark",variant:"dark",fixed:"top",children:(0,k.jsxs)(f.Z,{fluid:!0,children:[(0,k.jsx)(d.Z.Brand,{style:{cursor:"pointer"},onClick:function(t){e.loadMain(t,null)},children:"Editor"}),(0,k.jsx)(d.Z.Toggle,{}),(0,k.jsx)(d.Z.Collapse,{className:"justify-content-end",children:(0,k.jsxs)(p.Z,{children:[(0,k.jsx)(u.Z,{title:m,children:i}),(0,k.jsxs)(u.Z,{title:"Einstellungen",children:[(0,k.jsx)(u.Z.Item,{onClick:function(t){e.loadMain(t,"settings")},children:"Konto"}),(0,k.jsx)(u.Z.Item,{onClick:function(t){e.loadMain(t,"changelog")},children:"\xc4nderungen"})]}),(0,k.jsx)(p.Z.Link,{children:(0,k.jsx)(o.G,{icon:l.jLD,onClick:function(t){e.loadMain(t,"logout")},title:"abmelden"})})]})})]})})}var ze=[{title:"Beta 1.0",date:"2022-06-10",description:(0,k.jsx)(k.Fragment,{children:(0,k.jsx)("p",{children:"Beta Version online!"})})}]},8491:function(e,t,n){n.d(t,{m:function(){return h}});var r=n(5861),s=n(885),i=n(7757),a=n.n(i),c=n(9743),o=n(2677),l=n(3350),u=n(7022),d=n(2791),f=n(6407),p=n(3222),x=n(184);function h(){var e=(0,d.useState)(f.Q.me.first_name),t=(0,s.Z)(e,2),n=t[0],i=t[1],h=(0,d.useState)(f.Q.me.last_name),g=(0,s.Z)(h,2),m=g[0],v=g[1],j=(0,d.useState)(f.Q.me.email),Z=(0,s.Z)(j,2),k=Z[0],y=Z[1],w=(0,d.useState)(""),b=(0,s.Z)(w,2),_=b[0],C=b[1],S=(0,d.useState)(""),I=(0,s.Z)(S,2),N=I[0],Q=I[1],E=(0,d.useState)(f.Q.options.z_width),T=(0,s.Z)(E,2),D=T[0],B=T[1],z=(0,d.useState)(f.Q.options.action_key),A=(0,s.Z)(z,2),M=A[0],L=A[1],R=(0,d.useState)(f.Q.options.openExternally),O=(0,s.Z)(R,2),F=O[0],K=O[1],P=[(0,x.jsxs)(c.Z,{className:"mb-2",children:[(0,x.jsx)(o.Z,{xs:2,children:"Breite der Zettel:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Range,{min:"400",max:"600",size:"sm",value:D,onChange:function(e){f.Q.setOptions("z_width",e.target.value),f.Q.setOptions("z_height",.7*parseInt(e.target.value)),B(e.target.value)}})})]},1),(0,x.jsxs)(c.Z,{className:"mb-2",children:[(0,x.jsx)(o.Z,{xs:4,children:"\xd6ffnen der Ressourcen (Zettel im Editor):"}),(0,x.jsx)(o.Z,{children:(0,x.jsxs)(l.Z.Select,{size:"sm",value:F,onChange:function(e){f.Q.setOptions("openExternally",parseInt(e.target.value)),K(e.target.value)},children:[(0,x.jsx)("option",{value:"0",children:"im gleichen Fenster"}),(0,x.jsx)("option",{value:"1",children:"in einem neuen Fenster"}),(0,x.jsx)("option",{value:"2",children:"in Echo"})]})})]},2)];return(0,x.jsxs)(u.Z,{style:{padding:"0 10% 0 10%"},children:[(0,x.jsx)(c.Z,{children:(0,x.jsx)(o.Z,{children:(0,x.jsx)("h3",{children:"Pers\xf6nliche Daten"})})}),(0,x.jsxs)(c.Z,{className:"mb-2",children:[(0,x.jsx)(o.Z,{xs:2,children:"Vorname:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Control,{type:"text",size:"sm",value:n,onChange:function(e){i(e.target.value)}})})]}),(0,x.jsxs)(c.Z,{className:"mb-2",children:[(0,x.jsx)(o.Z,{xs:2,children:"Nachname:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Control,{type:"text",size:"sm",value:m,onChange:function(e){v(e.target.value)}})})]}),(0,x.jsxs)(c.Z,{className:"mb-4",children:[(0,x.jsx)(o.Z,{xs:2,children:"Email-Adresse:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Control,{type:"text",size:"sm",value:k,onChange:function(e){y(e.target.value)}})})]}),(0,x.jsxs)(c.Z,{className:"mb-4",children:[(0,x.jsx)(o.Z,{xs:2}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(p.YG,{value:"speichern",onClick:(0,r.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.Q.user.save({id:f.Q.me.id,first_name:n,last_name:m,email:k});case 2:return e.next=4,f.Q.getUser();case 4:return t=e.sent,f.Q.me=t,e.abrupt("return",{status:1});case 7:case"end":return e.stop()}}),e)})))})})]}),(0,x.jsx)(c.Z,{children:(0,x.jsx)(o.Z,{children:(0,x.jsx)("h3",{children:"Passwort"})})}),(0,x.jsxs)(c.Z,{className:"mb-2",children:[(0,x.jsx)(o.Z,{xs:2,children:"altes Passwort:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Control,{type:"password",size:"sm",value:_,onChange:function(e){C(e.target.value)}})})]}),(0,x.jsxs)(c.Z,{className:"mb-4",children:[(0,x.jsx)(o.Z,{xs:2,children:"neues Passwort:"}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(l.Z.Control,{type:"password",size:"sm",value:N,onChange:function(e){Q(e.target.value)}})})]}),(0,x.jsxs)(c.Z,{className:"mb-4",children:[(0,x.jsx)(o.Z,{xs:2}),(0,x.jsx)(o.Z,{children:(0,x.jsx)(p.YG,{value:"speichern",onClick:(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.Q.user.save({id:f.Q.me.id,old_password:_,new_password:N});case 2:return e.abrupt("return",{status:1});case 3:case"end":return e.stop()}}),e)})))})})]}),(0,x.jsx)(c.Z,{children:(0,x.jsx)(o.Z,{children:(0,x.jsx)("h3",{children:"Darstellung und Benutzung"})})}),(0,x.jsxs)(c.Z,{className:"mb-4",children:[(0,x.jsx)(o.Z,{xs:4,children:"Funktionstaste f\xfcr Tastenk\xfcrzel"}),(0,x.jsxs)(o.Z,{children:[(0,x.jsxs)(l.Z.Select,{size:"sm",value:M,onChange:function(e){f.Q.setOptions("action_key",e.target.value),L(e.target.value)},children:[(0,x.jsx)("option",{value:"alt",children:"Alt"}),(0,x.jsx)("option",{value:"ctrl",children:"Strg"}),(0,x.jsx)("option",{value:"cmd",children:"Befehlstaste"})]}),(0,x.jsxs)("small",{children:["Eine Liste mit Tastenk\xfcrzeln finden Sie ",(0,x.jsx)("a",{className:"text-primary",rel:"noreferrer",href:"https://gitlab.lrz.de/haeberlin/dmlw/-/wikis/06-Argos#tastenk\xfcrzel",target:"_blank",children:"hier"}),"."]})]})]}),P]})}},9410:function(e,t,n){var r=n(5987),s=n(1413),i=n(1694),a=n.n(i),c=n(2791),o=n(6543),l=n(162),u=n(6882),d=n(1991),f=n(184),p=["bsPrefix","size","hasValidation","className","as"],x=(0,o.Z)("input-group-text",{Component:"span"}),h=c.forwardRef((function(e,t){var n=e.bsPrefix,i=e.size,o=e.hasValidation,u=e.className,x=e.as,h=void 0===x?"div":x,g=(0,r.Z)(e,p);n=(0,l.vE)(n,"input-group");var m=(0,c.useMemo)((function(){return{}}),[]);return(0,f.jsx)(d.Z.Provider,{value:m,children:(0,f.jsx)(h,(0,s.Z)((0,s.Z)({ref:t},g),{},{className:a()(u,n,i&&"".concat(n,"-").concat(i),o&&"has-validation")}))})}));h.displayName="InputGroup",t.Z=Object.assign(h,{Text:x,Radio:function(e){return(0,f.jsx)(x,{children:(0,f.jsx)(u.Z,(0,s.Z)({type:"radio"},e))})},Checkbox:function(e){return(0,f.jsx)(x,{children:(0,f.jsx)(u.Z,(0,s.Z)({type:"checkbox"},e))})}})},2354:function(e,t,n){var r=n(1413),s=n(5987),i=n(1694),a=n.n(i),c=n(2791),o=n(162),l=n(5353),u=n(9102),d=n(184),f=["id","title","children","bsPrefix","className","rootCloseEvent","menuRole","disabled","active","renderMenuOnMount","menuVariant"],p=c.forwardRef((function(e,t){var n=e.id,i=e.title,c=e.children,p=e.bsPrefix,x=e.className,h=e.rootCloseEvent,g=e.menuRole,m=e.disabled,v=e.active,j=e.renderMenuOnMount,Z=e.menuVariant,k=(0,s.Z)(e,f),y=(0,o.vE)(void 0,"nav-item");return(0,d.jsxs)(l.Z,(0,r.Z)((0,r.Z)({ref:t},k),{},{className:a()(x,y),children:[(0,d.jsx)(l.Z.Toggle,{id:n,eventKey:null,active:v,disabled:m,childBsPrefix:p,as:u.Z,children:i}),(0,d.jsx)(l.Z.Menu,{role:g,renderOnMount:j,rootCloseEvent:h,variant:Z,children:c})]}))}));p.displayName="NavDropdown",t.Z=Object.assign(p,{Item:l.Z.Item,ItemText:l.Z.ItemText,Divider:l.Z.Divider,Header:l.Z.Header})},9102:function(e,t,n){var r=n(1413),s=n(885),i=n(5987),a=n(1694),c=n.n(a),o=n(2791),l=n(6445),u=n(4787),d=n(8633),f=n(162),p=n(184),x=["bsPrefix","className","as","active","eventKey"],h=o.forwardRef((function(e,t){var n=e.bsPrefix,a=e.className,o=e.as,h=void 0===o?l.Z:o,g=e.active,m=e.eventKey,v=(0,i.Z)(e,x);n=(0,f.vE)(n,"nav-link");var j=(0,u.v)((0,r.Z)({key:(0,d.h)(m,v.href),active:g},v)),Z=(0,s.Z)(j,2),k=Z[0],y=Z[1];return(0,p.jsx)(h,(0,r.Z)((0,r.Z)((0,r.Z)({},v),k),{},{ref:t,className:c()(a,n,v.disabled&&"disabled",y.isActive&&"active")}))}));h.displayName="NavLink",h.defaultProps={disabled:!1},t.Z=h}}]);
//# sourceMappingURL=814.6b718dd0.chunk.js.map